![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690943824584-bc0699b0-4ff8-4d27-8470-463dba34ebcb.png#averageHue=%23fdfdfd&clientId=ud6960a7e-07f8-4&from=paste&height=828&id=MQUqG&originHeight=1656&originWidth=3156&originalType=binary&ratio=2&rotation=0&showTitle=false&size=116668&status=done&style=none&taskId=u689710c7-a69b-49b4-b231-8bd3ab3bab2&title=&width=1578)
<a name="HQfk7"></a>
# 智慧校园云端管理系统的设计和实现
<a name="ik7KJ"></a>
## 项目简介
智慧校园云端管理系统主要用来管理校内学生、老师、班级、年级的相关信息，进行老师和学生信息记录和统计的功能，而这些信息是校园信息化建设的核心基础业务数据。项目采用前后端分离架构思想，前端采用HTML+CSS+VUE来实现页面效果展示，后端采用SpringBoot+MybatisPlus框架实现数据存储等服务。存储层使用高性能的MySQL，服务器使用SpringBoot内置的Tomcat9.x，项目构建工具使用Maven来管理jar包和项目构建。

> 智慧校园指的是信息化为基础构建起来的校园信息化教育管理的一种新的模式，智慧校园能够实现校园工作，学习和生活的一体化发展，在各种信息系统应用的基础上，能实现教学，科研管理和校园生活的有效融合。智慧校园建设所包括的内容很丰富，通过云计算，互联网技术将校园运行中的所有数据有效的联系在一起，通过相关软件系统的有效应用，实现学校智能监控和智能识别的综合信息服务平台的有效构建。
> 智慧校园有三个基本特征，第一，智慧校园能够提供个性化的服务，通过智能化服务平台及智能感知功能，实现教育管理工作的个性化服务。第二，智慧校园是建立在互联网基础上的， 通过互联网实现信息服务与校园各种应用领域的结合。第三，智慧校园在个性化定制服务的基础上，能够为学校与外部世界的联系提供有效的平台和接口，促进学校资源与外部资源的有效融合。智慧校园是校园信息化的一种高级形式，通过智慧校园可以把学校的物理空间和数字空间结合起来，为师生学习生活，提供智能化的学习生活环境，为师生提供个性化的智能服务。

<a name="tx5xg"></a>
## 项目技术栈
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690251401635-8474af42-e93e-4580-93fa-9183468b36f1.png#averageHue=%23edf5f8&clientId=uc85122a4-4c8a-4&from=paste&height=279&id=WVbiN&originHeight=557&originWidth=804&originalType=binary&ratio=2&rotation=0&showTitle=false&size=130455&status=done&style=none&taskId=ucdb0a491-08b1-4715-be7f-e4e979408c0&title=&width=402)
<a name="nj6xC"></a>
## 项目功能
智慧校园云端管理系统的使用者主要包含三种用户角色，其一是管理员角色，其二是老师角色，其三是学生角色。这三个角色的具体功能如下：

- 管理员角色：管理员登录智慧校园系统后可以进行相应的管理操作，主要包含：学生信息管理、老师信息管理、年级信息管理、班级信息管理、个人信息管理、账户密码重置等操作。
- 老师用户角色：老师用户登录智慧校园系统后可以进行参与相关学生、班级信息管理的相关操作以及个人信息管理等操作。
- 学生用户角色：学生进入系统后，主要查看自己的班级，同学信息以及个人信息管理等操作。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690943665916-e1a7c367-d814-4581-a8ff-8858bfa1cb6b.png#averageHue=%23fcfcfc&clientId=ud6960a7e-07f8-4&from=paste&height=859&id=u8a11cbcd&originHeight=1717&originWidth=1005&originalType=binary&ratio=2&rotation=0&showTitle=false&size=313572&status=done&style=none&taskId=u629a7fdf-b581-4c6b-971b-ddfb823d5ef&title=&width=502.5)


<a name="lY0Ho"></a>
## 项目开发
<a name="IoGsM"></a>
### 项目搭建
使用idea的springboot脚手架搭建一个maven项目<br />![1646278072789.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690944465230-cc8f36bf-9281-42b8-b95f-6036a92abc86.png#averageHue=%23f3f2f2&clientId=ud6960a7e-07f8-4&from=paste&height=420&id=u2d750d46&originHeight=840&originWidth=1004&originalType=binary&ratio=2&rotation=0&showTitle=false&size=47510&status=done&style=none&taskId=uc722c600-e6c3-46fa-8c5a-71ea496d5fa&title=&width=502)<br />项目创建完成后，更改一下maven的配置，改成自己的本地maven仓库。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690944649184-e3f156ec-1c49-42a3-929b-a8e1a2230a44.png#averageHue=%23c9a264&clientId=ud6960a7e-07f8-4&from=paste&height=685&id=uca4a3de6&originHeight=1369&originWidth=1959&originalType=binary&ratio=2&rotation=0&showTitle=false&size=175704&status=done&style=none&taskId=u3a5a7786-8597-4854-b7ac-0a19a39bb33&title=&width=979.5)

<a name="PbHYk"></a>
#### 修改pom.xml文件
```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<!--继承方式 使用spring-->
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.7.13</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.project</groupId>
	<artifactId>smart_campus</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>smart_campus</name>
	<description>smart_campus</description>

	<properties>
		<java.version>11</java.version>
	</properties>

	<dependencies>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<!--单元测试启动器-->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
		<!-- thymeleaf支持-->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-thymeleaf</artifactId>
		</dependency>

		<!--  mybatis-plus-->
		<dependency>
			<groupId>com.baomidou</groupId>
			<artifactId>mybatis-plus-boot-starter</artifactId>
			<version>3.3.1</version>
		</dependency>

		<!-- 依赖MyBatis核心包 -->
		<dependency>
			<groupId>org.mybatis</groupId>
			<artifactId>mybatis</artifactId>
			<version>3.5.7</version>
		</dependency>

		<!-- 简化POJO实体类开发 -->
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<optional>true</optional>
		</dependency>

		<!--mysql-->
		<dependency>
			<groupId>mysql</groupId>
			<artifactId>mysql-connector-java</artifactId>
			<version>8.0.28</version>
		</dependency>

		<dependency>
			<groupId>com.baomidou</groupId>
			<artifactId>mybatis-plus-generator</artifactId>
			<version>3.3.1</version>
		</dependency>
		<dependency>
			<groupId>org.freemarker</groupId>
			<artifactId>freemarker</artifactId>
			<version>2.3.31</version>
		</dependency>

		<!--swagger-->
		<dependency>
			<groupId>io.springfox</groupId>
			<artifactId>springfox-swagger2</artifactId>
			<version>2.7.0</version>
		</dependency>
		<!--swagger ui-->
		<dependency>
			<groupId>io.springfox</groupId>
			<artifactId>springfox-swagger-ui</artifactId>
			<version>2.7.0</version>
		</dependency>
		<!--swagger2  增强版接口文档-->
		<dependency>
			<groupId>com.github.xiaoymin</groupId>
			<artifactId>knife4j-spring-boot-starter</artifactId>
			<version>2.0.4</version>
		</dependency>

		<dependency>
			<groupId>javax.xml.bind</groupId>
			<artifactId>jaxb-api</artifactId>
			<version>2.3.0</version>
		</dependency>


		<!--开发者工具-->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
			<optional>true</optional>
		</dependency>

		<dependency>
			<groupId>com.alibaba</groupId>
			<artifactId>fastjson</artifactId>
			<version>1.2.29</version>
		</dependency>

		<!-- JWT生成Token-->
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt</artifactId>
			<version>0.7.0</version>
		</dependency>

		<dependency>
			<groupId>commons-fileupload</groupId>
			<artifactId>commons-fileupload</artifactId>
			<version>1.4</version>
		</dependency>

	</dependencies>

	<build>
		<plugins>
			<!--spring boot maven插件 , 可以将项目运行依赖的jar包打到我们的项目中-->
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>

			<!-- 具体插件，逆向工程的操作是以构建过程中插件形式出现的 -->
			<plugin>
				<groupId>org.mybatis.generator</groupId>
				<artifactId>mybatis-generator-maven-plugin</artifactId>
				<version>1.3.0</version>

				<!-- 插件的依赖 -->
				<dependencies>

					<!-- 逆向工程的核心依赖 -->
					<dependency>
						<groupId>org.mybatis.generator</groupId>
						<artifactId>mybatis-generator-core</artifactId>
						<version>1.3.2</version>
					</dependency>

					<!-- 数据库连接池 -->
					<dependency>
						<groupId>com.mchange</groupId>
						<artifactId>c3p0</artifactId>
						<version>0.9.2</version>
					</dependency>

					<!-- MySQL驱动 -->
					<dependency>
						<groupId>mysql</groupId>
						<artifactId>mysql-connector-java</artifactId>
						<version>8.0.28</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>

</project>
```
<a name="x7CUi"></a>
#### 项目包结构

1.  java目录下 
   - config : 项目的配置类
   - controller: 控制层
   - mapper : 持久层接口
   - pojo :  实体类
   - service: 服务层
   - util: 工具类包
   - SmartCampusApplication : 启动类
2.  resources目录下 
   - mapper :持久层映射文件
   - public/upload:文件上传目录
   - static: 静态资源目录
   - application.yml :SpringBoot核心配置文

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690343287085-f9fceae7-1ac5-4bec-9545-e6969d23b0e8.png#averageHue=%23f7f6f6&clientId=uba56f725-bbf1-4&from=paste&height=326&id=uc638b0d0&originHeight=652&originWidth=598&originalType=binary&ratio=2&rotation=0&showTitle=false&size=29046&status=done&style=none&taskId=u0ffdb7c5-0829-45ef-baaa-02307035043&title=&width=299)

> 这里注意一下：public/upload
> 设置该目录时，如果为public.upload,那么在本地文件夹，并不会创建一个public下的新文件夹upload ,默认为该文件的文件名。
> 但是如果设置时，按照这种 public/upload 格式，虽然在目录中显示为public.upload （这是因为public目录下目前只有一个文件夹），但是实际上upload是public文件夹下的一个文件。

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690946533940-e08ce474-c51b-4bff-b8fc-7f452d8acb0a.png#averageHue=%23f9f9f9&clientId=ud6960a7e-07f8-4&from=paste&height=114&id=u4d112701&originHeight=228&originWidth=844&originalType=binary&ratio=2&rotation=0&showTitle=false&size=11572&status=done&style=none&taskId=u7d6907ea-b027-4689-8b0b-e283dae980e&title=&width=422)
<a name="AlICH"></a>
#### 配置application.yml文件
```
server:
  port: 9000
spring:
  #解决SpringBoot2.6.0与swagger冲突问题【原因是在springboot2.6.0中将SpringMVC 默认路径匹配策略从AntPathMatcher 更改为PathPatternParser，导致出错，解决办法是切换回原先的AntPathMatcher】
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  #配置数据源
  datasource:
    #配置数据源类型
    type: com.zaxxer.hikari.HikariDataSource

    #配置数据库连接属性
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://......./sgg_zhxy_db?characterEncoding=utf-8&serverTimezone=GMT%2B8&userSSL=false
    username: root
    password: root
    
    #mybatis-plus内置连接池
    hikari:
      connection-test-query: SELECT 1
      connection-timeout: 60000
      idle-timeout: 500000
      max-lifetime: 540000
      maximum-pool-size: 12
      minimum-idle: 10
      pool-name: GuliHikariPool

  thymeleaf:
    #模板的模式，支持 HTML, XML TEXT JAVASCRIPT
    mode: HTML5
    #编码 可不用配置
    encoding: UTF-8
    #开发配置为false,避免修改模板还要重启服务器
    cache: false
    #配置模板路径，默认是templates，可以不用配置
    prefix: classpath:/static/
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
  servlet:
    #设置文件上传上限
    multipart:
      max-file-size: 10MB
      max-request-size: 100MB
mybatis-plus:
  configuration:
    #添加日志支持
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  mapper-locations: classpath*:/mapper/**/*.xml
```
<a name="BDNQH"></a>
##### Hikari
**hikari使用**
```
<dependency>
   <groupId>com.zaxxer</groupId>
   <artifactId>HikariCP</artifactId>
   <version>5.0.0</version>
</dependency>
```
初始化
```
HikariDataSource ds = new HikariDataSource();
ds.setJdbcUrl("jdbc:mysql://localhost:3306/test");
ds.setUsername("root");
ds.setPassword("123456");
```
基于配置文件的初始化
```
HikariConfig config = new HikariConfig("/../hikari.properties");
HikariDataSource ds = new HikariDataSource(config);


// properties file
dataSourceClassName=org.postgresql.ds.PGSimpleDataSource
dataSource.user=test
dataSource.password=test
dataSource.databaseName=mydb
dataSource.portNumber=5432
dataSource.serverName=localhost
```
常用参数
```
    hikari:
      connection-test-query: SELECT 1
      connection-timeout: 60000
      idle-timeout: 500000
      max-lifetime: 540000
      maximum-pool-size: 12
      minimum-idle: 10
      pool-name: GuliHikariPool
```

> 根据 less is more 的设计哲学，以 Hikari 开头的配置都是可选的配置，都有默认的值，不配也行的。

| name | 描述 | 构造器默认值 | 默认配置validate之后的值 | validate重置 |
| --- | --- | --- | --- | --- |
| autoCommit | 自动提交从池中返回的连接 | true | true | - |
| connectionTimeout | 等待来自池的连接的最大毫秒数 | SECONDS.toMillis(30) = 30000 | 30000 | 如果小于250毫秒，则被重置回30秒 |
| idleTimeout | 连接允许在池中闲置的最长时间 | MINUTES.toMillis(10) = 600000 | 600000 | 如果idleTimeout+1秒>maxLifetime 且 maxLifetime>0，则会被重置为0（代表永远不会退出）；如果idleTimeout!=0且小于10秒，则会被重置为10秒 |
| maxLifetime | 池中连接最长生命周期 | MINUTES.toMillis(30) = 1800000 | 1800000 | 如果不等于0且小于30秒则会被重置回30分钟 |
| connectionTestQuery | 如果您的驱动程序支持JDBC4，我们强烈建议您不要设置此属性 | null | null | - |
| minimumIdle | 池中维护的最小空闲连接数 | -1 | 10 | minIdle<0或者minIdle>maxPoolSize,则被重置为maxPoolSize |
| maximumPoolSize | 池中最大连接数，包括闲置和使用中的连接 | -1 | 10 | 如果maxPoolSize小于1，则会被重置。当minIdle<=0被重置为DEFAULT_POOL_SIZE则为10;如果minIdle>0则重置为minIdle的值 |
| metricRegistry | 该属性允许您指定一个 Codahale / Dropwizard MetricRegistry 的实例，供池使用以记录各种指标 | null | null | - |
| healthCheckRegistry | 该属性允许您指定池使用的Codahale / Dropwizard HealthCheckRegistry的实例来报告当前健康信息 | null | null | - |
| poolName | 连接池的用户定义名称，主要出现在日志记录和JMX管理控制台中以识别池和池配置 | null | HikariPool-1 | - |
| initializationFailTimeout | 如果池无法成功初始化连接，则此属性控制池是否将 fail fast | 1 | 1 | - |
| isolateInternalQueries | 是否在其自己的事务中隔离内部池查询，例如连接活动测试 | false | false | - |
| allowPoolSuspension | 控制池是否可以通过JMX暂停和恢复 | false | false | - |
| readOnly | 从池中获取的连接是否默认处于只读模式 | false | false | - |
| registerMbeans | 是否注册JMX管理Bean（MBeans） | false | false | - |
| catalog | 为支持 catalog 概念的数据库设置默认 catalog | driver default | null | - |
| connectionInitSql | 该属性设置一个SQL语句，在将每个新连接创建后，将其添加到池中之前执行该语句。 | null | null | - |
| driverClassName | HikariCP将尝试通过仅基于jdbcUrl的DriverManager解析驱动程序，但对于一些较旧的驱动程序，还必须指定driverClassName | null | null | - |
| transactionIsolation | 控制从池返回的连接的默认事务隔离级别 | null | null | - |
| validationTimeout | 连接将被测试活动的最大时间量 | SECONDS.toMillis(5) = 5000 | 5000 | 如果小于250毫秒，则会被重置回5秒 |
| leakDetectionThreshold | 记录消息之前连接可能离开池的时间量，表示可能的连接泄漏 | 0 | 0 | 如果大于0且不是单元测试，则进一步判断：(leakDetectionThreshold < SECONDS.toMillis(2) or (leakDetectionThreshold > maxLifetime && maxLifetime > 0)，会被重置为0 . 即如果要生效则必须>0，而且不能小于2秒，而且当maxLifetime > 0时不能大于maxLifetime |
| dataSource | 这个属性允许你直接设置数据源的实例被池包装，而不是让HikariCP通过反射来构造它 | null | null | - |
| schema | 该属性为支持模式概念的数据库设置默认模式 | driver default | null | - |
| threadFactory | 此属性允许您设置将用于创建池使用的所有线程的java.util.concurrent.ThreadFactory的实例。 | null | null | - |
| scheduledExecutor | 此属性允许您设置将用于各种内部计划任务的java.util.concurrent.ScheduledExecutorService实例 | null | null | - |


<a name="jXErZ"></a>
##### jackson
Jackson 是当前用的比较广泛的，用来序列化和反序列化 json 的 Java 的开源框架.<br />优点：

- Jackson 解析大的 json 文件速度比较快；
- Jackson 运行时占用内存比较低，性能比较好；
- Jackson 有灵活的 API，可以很容易进行扩展和定制。
```
    <!-- springboot-json -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-json</artifactId>
    </dependency>
```
按照这种格式去解析日期和时区
```
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
```
<a name="ixS77"></a>
##### mybatis-plus
```
mybatis-plus:
  configuration:
    #添加日志支持
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  mapper-locations: classpath*:/mapper/**/*.xml
```
 mapper-locations: classpath*:/mapper/**/*.xml<br />设置映射文件位置:<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690361145644-5f786700-6276-4d4b-8fff-2b7577dc670e.png#averageHue=%23f8f5f5&clientId=uacebe55e-f556-4&from=paste&height=394&id=ue1c9b559&originHeight=787&originWidth=570&originalType=binary&ratio=2&rotation=0&showTitle=false&size=33530&status=done&style=none&taskId=u13fa0462-7364-4566-8590-63854bf76fa&title=&width=285)


<a name="tmvQk"></a>
#### 配置类
<a name="oe4QR"></a>
##### 分页插件配置类
```
@Configuration
@MapperScan("com.project.smart_campus.mapper")
public class MyConfig {

    /*
    * 分页插件
    * */
    
    @Bean
    public PaginationInterceptor paginationInterceptor(){
        PaginationInterceptor paginationInterceptor=new PaginationInterceptor();
        return paginationInterceptor;
    }

}

```
<a name="rQpeM"></a>
##### Swagger2的配置类
引入依赖
```
<!--swagger-->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>2.7.0</version>
</dependency>
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger-ui</artifactId>
    <version>2.7.0</version>
</dependency>
```
配置类
```
@Configuration
@EnableSwagger2
public class Swagger2Config {

    @Bean
    public Docket webApiConfig(){

        //添加head参数start
        List<Parameter> parameters=new ArrayList<>();
        ParameterBuilder tokenPar=new ParameterBuilder();
        tokenPar.name("userId")
                .description("测试用户1")
                .defaultValue("1")
                .modelRef(new ModelRef("string"))
                .parameterType("header")
                .required(false)
                .build();
        parameters.add(tokenPar.build());

        ParameterBuilder tmpPar = new ParameterBuilder();
        tmpPar.name("userTempId")
                .description("测试用户2")
                .defaultValue("1")
                .modelRef(new ModelRef("string"))
                .parameterType("header")
                .required(false)
                .build();
        parameters.add(tmpPar.build());
        //添加head参数end

        return new Docket(DocumentationType.SWAGGER_2)
                .groupName("webApi")
                .apiInfo(webApiInfo())
                .select()
                //可以测试请求头中：输入token
                //.apis(RequestHandlerSelectors.withClassAnnotation(ApiOperation.class))
                .apis(RequestHandlerSelectors.basePackage("com.project.smart_campus.controller"))
                //过滤掉admin路径下的所有页面
                //.paths(Predicates.and(PathSelectors.regex("/sms/.*")))
                //过滤掉所有error或error.*页面
                //.paths(Predicates.not(PathSelectors.regex("/error.*")))
                .build()
                .globalOperationParameters(parameters);

    }

    private ApiInfo webApiInfo(){

        return new ApiInfoBuilder()
                .title("网站-API文档")
                .description("本文档描述了网站微服务接口定义")
                .version("1.0")
                .contact(new Contact("sc", "http://mypoject.com", "123456@qq.com"))
                .build();
    }

    private ApiInfo adminApiInfo(){

        return new ApiInfoBuilder()
                .title("后台管理系统-API文档")
                .description("本文档描述了后台管理系统微服务接口定义")
                .version("1.0")
                .contact(new Contact("sc", "http://mypoject.com", "123456@qq.com"))
                .build();
    }


}
```
**常用配置参数表**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691027008340-9324dff2-1eac-4af4-ac8c-9a0a07626ebf.png#averageHue=%23f5f5f4&clientId=u12c4aefb-d43d-4&from=paste&height=231&id=u9395209f&originHeight=462&originWidth=1432&originalType=binary&ratio=2&rotation=0&showTitle=false&size=76506&status=done&style=none&taskId=ua4133c24-c9b9-48a0-aea0-726fc9eaacc&title=&width=716)<br />**swagger常用注解表**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691027135890-3d85ece0-0f37-4cd4-80c1-f31c56104b61.png#averageHue=%23f6f5f5&clientId=u12c4aefb-d43d-4&from=paste&height=470&id=uf1a3b9fc&originHeight=940&originWidth=1537&originalType=binary&ratio=2&rotation=0&showTitle=false&size=178049&status=done&style=none&taskId=u5e75106b-b2ef-4067-9423-c0f179cf32d&title=&width=768.5)<br />**Swagger2 常用注解@ApiOperation@ApiParam**<br />**@ApiOperation**（使用于在方法上，表示一个http请求的操作）

- value用于方法描述
- notes用于提示内容
- tags可以重新分组（视情况而用）

**@ApiParam**<br />使用在方法上或者参数上，字段说明；表示对参数的添加元数据（说明或是否必填等）

- name–参数名
- value–参数说明
- required–是否必填

学生管理系统接口文档示例：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690640141513-b414db8d-430e-4224-b4d7-cbbd9e3b7c7a.png#averageHue=%23eef1e3&clientId=ud308e548-02f1-4&from=paste&height=661&id=hHIfv&originHeight=1322&originWidth=1612&originalType=binary&ratio=2&rotation=0&showTitle=false&size=285311&status=done&style=none&taskId=ua4dc210a-ff15-4c01-88dc-9adda5aef42&title=&width=806)
<a name="jAEzR"></a>
#### 工具类

<a name="QpqxD"></a>
##### 验证码图片生成类
先定义验证码图片的基本属性，随后是验证码图片（获取）+验证码（生成+获取+绘制）
```
public class CreateVerifiCodeImage {

    /*
    * 定义长宽，字符大小，验证码，验证码图片
    * */
    private static int WIDTH = 90;
    private static int HEIGHT = 35;
    private static int FONT_SIZE = 20;
    private static char[] verifiCode;
    private static BufferedImage verifiCodeImage;

    /**
     * @description: 获取验证码图片
     * @param: no
     * @return: java.awt.image.BufferedImage
     */
    public static BufferedImage getVerifiCodeImage() {
        verifiCodeImage = new BufferedImage(WIDTH, HEIGHT, BufferedImage.TYPE_INT_BGR);// create a image
        Graphics graphics = verifiCodeImage.getGraphics();

        verifiCode = generateCheckCode();
        drawBackground(graphics);
        drawRands(graphics, verifiCode);

        graphics.dispose();

        return verifiCodeImage;
    }

    /**
     * @description: 获取验证码
     * @param: no
     * @return: char[]
     */
    public static char[] getVerifiCode() {
        return verifiCode;
    }

    /**
     * @description: 随机生成验证码
     * @param: no
     * @return: char[]
     */
    private static char[] generateCheckCode() {
        String chars = "0123456789abcdefghijklmnopqrstuvwxyz" + "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        char[] rands = new char[4];
        for (int i = 0; i < 4; i++) {
            int rand = (int) (Math.random() * (10 + 26 * 2));
            rands[i] = chars.charAt(rand);
        }
        return rands;
    }

    /**
     * @description: 绘制验证码
     * @param: g
     * @param: rands
     * @return: void
     */
    private static void drawRands(Graphics g, char[] rands) {
        g.setFont(new Font("Console", Font.BOLD, FONT_SIZE));

        for (int i = 0; i < rands.length; i++) {

            g.setColor(getRandomColor());
            g.drawString("" + rands[i], i * FONT_SIZE + 10, 25);
        }
    }

    /**
     * @description: 绘制验证码图片背景
     * @param: g
     * @return: void
     */
    private static void drawBackground(Graphics g) {

        g.setColor(Color.white);
        g.fillRect(0, 0, WIDTH, HEIGHT);

        // 绘制验证码干扰点
        for (int i = 0; i < 200; i++) {
            int x = (int) (Math.random() * WIDTH);
            int y = (int) (Math.random() * HEIGHT);
            g.setColor(getRandomColor());
            g.drawOval(x, y, 1, 1);

        }
    }


    /**
     * @description: 获取随机颜色
     * @param: no
     * @return: java.awt.Color
     */
    private static Color getRandomColor() {
        Random ran = new Random();
        return new Color(ran.nextInt(220), ran.nextInt(220), ran.nextInt(220));
    }


}
```
<a name="lXAwd"></a>
#####  JwtHelper
token口令生成
```
public class JwtHelper {
    private static long tokenExpiration = 24*60*60*1000;
    private static String tokenSignKey = "123456";

    //生成token字符串
    public static String createToken(Long userId, Integer userType) {
        String token = Jwts.builder()

                .setSubject("YYGH-USER")

                .setExpiration(new Date(System.currentTimeMillis() + tokenExpiration))

                .claim("userId", userId)
//                .claim("userName", userName)
                .claim("userType", userType)

                .signWith(SignatureAlgorithm.HS512, tokenSignKey)
                .compressWith(CompressionCodecs.GZIP)
                .compact();
        return token;
    }

    //从token字符串获取userid
    public static Long getUserId(String token) {
        if(StringUtils.isEmpty(token)) return null;
        Jws<Claims> claimsJws = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);
        Claims claims = claimsJws.getBody();
        Integer userId = (Integer)claims.get("userId");
        return userId.longValue();
    }

    //从token字符串获取userType
    public static Integer getUserType(String token) {
        if(StringUtils.isEmpty(token)) return null;
        Jws<Claims> claimsJws
                = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);
        Claims claims = claimsJws.getBody();
        return (Integer)(claims.get("userType"));
    }

    //从token字符串获取userName
    public static String getUserName(String token) {
        if(StringUtils.isEmpty(token)) return "";
        Jws<Claims> claimsJws
                = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);
        Claims claims = claimsJws.getBody();
        return (String)claims.get("userName");
    }

    //判断token是否有效
    public static boolean isExpiration(String token){
        try {
            boolean isExpire = Jwts.parser()
                    .setSigningKey(tokenSignKey)
                    .parseClaimsJws(token)
                    .getBody()
                    .getExpiration().before(new Date());
            //没有过期，有效，返回false
            return isExpire;
        }catch(Exception e) {
            //过期出现异常，返回true
            return true;
        }
    }


    /**
     * 刷新Token
     * @param token
     * @return
     */
    public String refreshToken(String token) {
        String refreshedToken;
        try {
            final Claims claims = Jwts.parser()
                    .setSigningKey(tokenSignKey)
                    .parseClaimsJws(token)
                    .getBody();
            refreshedToken = JwtHelper.createToken(getUserId(token), getUserType(token));
        } catch (Exception e) {
            refreshedToken = null;
        }
        return refreshedToken;
    }
    
}
```

<a name="LD137"></a>
##### AuthContextHolder类
从request请求中获取token口令
```
public class AuthContextHolder {

    //从请求头token获取userid
    public static Long getUserIdToken(HttpServletRequest request) {
        //从请求头token
        String token = request.getHeader("token");
        //调用工具类
        Long userId = JwtHelper.getUserId(token);
        return userId;
    }

    //从请求头token获取name
    public static String getUserName(HttpServletRequest request) {
        //从header获取token
        String token = request.getHeader("token");
        //jwt从token获取username
        String userName = JwtHelper.getUserName(token);
        return userName;
    }

}
```

<a name="fMQ5O"></a>
##### MD5加密类
```
public final class MD5 {

    public static String encrypt(String strSrc) {
        try {
            char hexChars[] = { '0', '1', '2', '3', '4', '5', '6', '7', '8',
                    '9', 'a', 'b', 'c', 'd', 'e', 'f' };

            //getBytes(String charsetName): 使用指定的字符集将字符串编码为 byte 序列，并将结果存储到一个新的 byte 数组中。
            byte[] bytes = strSrc.getBytes();

            //获取MD5摘要算法的MessageDiges 的对象
            MessageDigest md=MessageDigest.getInstance("MD5");
            //使用了指定字节更新摘要
            md.update(bytes);

            //对于给定数量的更新数据，digest 方法只能被调用一次。在调用 digest 之后，MessageDigest 对象被重新设置成其初始状态。
            bytes = md.digest();

            // 获取初识状态下摘要的长度
            int j = bytes.length;
            char[] chars = new char[j * 2];
            int k = 0;
            for (int i = 0; i < bytes.length; i++) {
                byte b = bytes[i];
                chars[k++] = hexChars[b >>> 4 & 0xf];
                chars[k++] = hexChars[b & 0xf];
            }

            //返回加密后的md5密钥串
            return new String(chars);
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
            throw new RuntimeException("MD5加密出错！！+" + e);
        }

    }


}
```
<a name="sAXCu"></a>
##### 全局统一返回类
```
@Data
@ApiModel(value = "全局统一返回结果")
public class Result<T> {
    @ApiModelProperty(value = "返回码")
    private Integer code;

    @ApiModelProperty(value = "返回消息")
    private String message;

    @ApiModelProperty(value = "返回数据")
    private T data;

    public Result(){}

    // 返回数据
    protected static <T> Result<T> build(T data) {
        Result<T> result = new Result<T>();
        if (data != null)
            result.setData(data);
        return result;
    }

    public static <T> Result<T> build(T body, ResultCodeEnum resultCodeEnum) {
        Result<T> result = build(body);
        result.setCode(resultCodeEnum.getCode());
        result.setMessage(resultCodeEnum.getMessage());
        return result;
    }

    public static<T> Result<T> ok(){
        return Result.ok(null);
    }

    /**
     * 操作成功
     * @param data
     * @param <T>
     * @return
     */
    public static<T> Result<T> ok(T data){
        Result<T> result = build(data);
        return build(data, ResultCodeEnum.SUCCESS);
    }

    public static<T> Result<T> fail(){
        return Result.fail(null);
    }

    /**
     * 操作失败
     * @param data
     * @param <T>
     * @return
     */
    public static<T> Result<T> fail(T data){
        Result<T> result = build(data);
        return build(data, ResultCodeEnum.FAIL);
    }

    public Result<T> message(String msg){
        this.setMessage(msg);
        return this;
    }

    public Result<T> code(Integer code){
        this.setCode(code);
        return this;
    }

    public boolean isOk() {
        if(this.getCode().intValue() == ResultCodeEnum.SUCCESS.getCode().intValue()) {
            return true;
        }
        return false;
    }
}
```
![](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690548113825-3926d2c1-123f-4c9b-a81b-5ecebc80d413.png#averageHue=%23fdfafa&from=url&id=VH9c1&originHeight=256&originWidth=1066&originalType=binary&ratio=2&rotation=0&showTitle=false&status=done&style=none&title=)
<a name="JyZrz"></a>
##### 返回状态结果响应类
```
@Getter
public enum ResultCodeEnum {

    SUCCESS(200,"成功"),
    FAIL(201, "失败"),
    SERVICE_ERROR(2012, "服务异常"),
    ILLEGAL_REQUEST( 204, "非法请求"),
    PAY_RUN(205, "支付中"),
    ARGUMENT_VALID_ERROR(206, "参数校验错误"),

    LOGIN_ERROR(207, "用户名或密码错误"),
    LOGIN_AUTH(208, "未登陆"),
    PERMISSION(209, "没有权限"),
    SECKILL_NO_START(210, "秒杀还没开始"),
    SECKILL_RUN(211, "正在排队中"),
    SECKILL_NO_PAY_ORDER(212, "您有未支付的订单"),
    SECKILL_FINISH(213, "已售罄"),
    SECKILL_END(214, "秒杀已结束"),
    SECKILL_SUCCESS(215, "抢单成功"),
    SECKILL_FAIL(216, "抢单失败"),
    SECKILL_ILLEGAL(217, "请求不合法"),
    SECKILL_ORDER_SUCCESS(218, "下单成功"),
    COUPON_GET(220, "优惠券已经领取"),
    COUPON_LIMIT_GET(221, "优惠券已发放完毕"),
   
    LOGIN_CODE(222,"长时间未操作,会话已失效,请刷新页面后重试!"),
    CODE_ERROR(223,"验证码错误!"),
    TOKEN_ERROR(224,"Token无效!");

    private Integer code;

    private String message;

    private ResultCodeEnum(Integer code, String message) {
        this.code = code;
        this.message = message;
    }

}

```
<a name="OasKm"></a>
##### 文件上传类
```
public class UploadFile {
    //存储文件上传失败的错误信息
    private static Map<String, Object> error_result = new HashMap<>();
    //存储头像的上传结果信息
    private static Map<String, Object> upload_result = new HashMap<>();

    /**
     * @description: 效验所上传图片的大小及格式等信息...
     * @param: photo
     * @param: path
     * @return: java.util.Map<java.lang.String, java.lang.Object>
     */
    private static Map<String, Object> uploadPhoto(MultipartFile photo, String path) {
        //限制头像大小(20M)
        int MAX_SIZE = 20971520;
        //获取图片的原始名称
        String orginalName = photo.getOriginalFilename();
        //如果保存文件的路径不存在,则创建该目录
        File filePath = new File(path);
        if (!filePath.exists()) {
            filePath.mkdirs();
        }
        //限制上传文件的大小
        if (photo.getSize() > MAX_SIZE) {
            error_result.put("success", false);
            error_result.put("msg", "上传的图片大小不能超过20M哟!");
            return error_result;
        }
        // 限制上传的文件类型
        String[] suffixs = new String[]{".png", ".PNG", ".jpg", ".JPG", ".jpeg", ".JPEG", ".gif", ".GIF", ".bmp", ".BMP"};
        SuffixFileFilter suffixFileFilter = new SuffixFileFilter(suffixs);
        if (!suffixFileFilter.accept(new File(path + orginalName))) {
            error_result.put("success", false);
            error_result.put("msg", "禁止上传此类型文件! 请上传图片哟!");
            return error_result;
        }

        return null;
    }

    /**
     * @description: (提取公共代码 : 提高代码的可重用性)获取头像的上传结果信息
     * @param: photo
     * @param: dirPaht
     * @param: portraitPath
     * @return: java.util.Map<java.lang.String, java.lang.Object>
     */
    public static Map<String, Object> getUploadResult(MultipartFile photo, String dirPaht, String portraitPath) {

        if (!photo.isEmpty() && photo.getSize() > 0) {
            //获取图片的原始名称
            String orginalName = photo.getOriginalFilename();
            //上传图片,error_result:存储头像上传失败的错误信息
            Map<String, Object> error_result = UploadFile.uploadPhoto(photo, dirPaht);
            if (error_result != null) {
                return error_result;
            }
            //使用UUID重命名图片名称(uuid__原始图片名称)
            String newPhotoName = UUID.randomUUID() + "__" + orginalName;
            //将上传的文件保存到目标目录下
            try {
                photo.transferTo(new File(dirPaht + newPhotoName));
                upload_result.put("success", true);
                upload_result.put("portrait_path", portraitPath + newPhotoName);//将存储头像的项目路径返回给页面
            } catch (IOException e) {
                e.printStackTrace();
                upload_result.put("success", false);
                upload_result.put("msg", "上传文件失败! 服务器端发生异常!");
                return upload_result;
            }

        } else {
            upload_result.put("success", false);
            upload_result.put("msg", "头像上传失败! 未找到指定图片!");
        }
        return upload_result;
    }
}
```

<a name="VH0yO"></a>
#### pojo和mapper类
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691034849100-1269d8f4-c48e-4e00-b8f8-a8215853d256.png#averageHue=%23faf9f9&clientId=u12c4aefb-d43d-4&from=paste&height=155&id=u7e232595&originHeight=309&originWidth=504&originalType=binary&ratio=2&rotation=0&showTitle=false&size=12103&status=done&style=none&taskId=u51716475-0fa7-4073-9f7b-d956e66254a&title=&width=252)<br />根据数据库表的信息，可以借助mybatis的逆向工程生成。<br />**配至pom.xml**
```
<!-- 依赖MyBatis核心包 -->
<dependencies>
    <dependency>
        <groupId>org.mybatis</groupId>
        <artifactId>mybatis</artifactId>
        <version>3.5.7</version>
    </dependency>
</dependencies>
    
<!-- 控制Maven在构建过程中相关配置 -->
<build>
        
    <!-- 构建过程中用到的插件 -->
    <plugins>
        
        <!-- 具体插件，逆向工程的操作是以构建过程中插件形式出现的 -->
        <plugin>
            <groupId>org.mybatis.generator</groupId>
            <artifactId>mybatis-generator-maven-plugin</artifactId>
            <version>1.3.0</version>
    
            <!-- 插件的依赖 -->
            <dependencies>
                
                <!-- 逆向工程的核心依赖 -->
                <dependency>
                    <groupId>org.mybatis.generator</groupId>
                    <artifactId>mybatis-generator-core</artifactId>
                    <version>1.3.2</version>
                </dependency>
                    
                <!-- 数据库连接池 -->
                <dependency>
                    <groupId>com.mchange</groupId>
                    <artifactId>c3p0</artifactId>
                    <version>0.9.2</version>
                </dependency>
                    
                <!-- MySQL驱动 -->
                <dependency>
                    <groupId>mysql</groupId>
                    <artifactId>mysql-connector-java</artifactId>
                    <version>8.0.27</version>
                </dependency>
            </dependencies>
        </plugin>
    </plugins>
</build>

```
**配置generatorConfig.xml**
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE generatorConfiguration
        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
<generatorConfiguration>
    <!--
            targetRuntime: 执行生成的逆向工程的版本
                    MyBatis3Simple: 生成基本的CRUD（清新简洁版）
                    MyBatis3: 生成带条件的CRUD（奢华尊享版）
     -->
    <context id="DB2Tables" targetRuntime="MyBatis3">
        <!-- 数据库的连接信息 -->
        <jdbcConnection driverClass="com.mysql.jdbc.Driver"
                        connectionURL="jdbc:mysql://..../sc_tb"
                        userId="root"
                        password="123456">
        </jdbcConnection>
        <!-- javaBean的生成策略-->
        <javaModelGenerator targetPackage="com.project.smart_campus.pojo" targetProject=".\src\main\java">
            <property name="enableSubPackages" value="true" />
            <property name="trimStrings" value="true" />
        </javaModelGenerator>
        <!-- SQL映射文件的生成策略 -->
        <sqlMapGenerator targetPackage="com.project.smart_campus.mapper"  targetProject=".\src\main\resources">
            <property name="enableSubPackages" value="true" />
        </sqlMapGenerator>
        <!-- Mapper接口的生成策略 -->
        <javaClientGenerator type="XMLMAPPER" targetPackage="com.project.smart_campus.mapper"  targetProject=".\src\main\java">
            <property name="enableSubPackages" value="true" />
        </javaClientGenerator>
        <!-- 逆向分析的表 -->
        <!-- tableName设置为*号，可以对应所有表，此时不写domainObjectName -->
        <!-- domainObjectName属性指定生成出来的实体类的类名 -->
        <table tableName="tb_test" domainObjectName="Test"/>
    </context>
</generatorConfiguration>

```
**执行generate目标**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691035126429-b95acf3d-1eca-43f5-8353-6c57d3847010.png#averageHue=%23f7f3f2&clientId=u12c4aefb-d43d-4&from=paste&height=600&id=u0cdfe58d&originHeight=1199&originWidth=429&originalType=binary&ratio=2&rotation=0&showTitle=false&size=74229&status=done&style=none&taskId=u6185e8c3-086d-4a4e-87bb-94d63f22012&title=&width=214.5)

生成相对应的mapper类和pojo类<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691035198945-f1a44d54-220e-4939-a57a-c198382299dd.png#averageHue=%23f9f8f8&clientId=u12c4aefb-d43d-4&from=paste&height=320&id=u7ddaf9b9&originHeight=639&originWidth=523&originalType=binary&ratio=2&rotation=0&showTitle=false&size=35863&status=done&style=none&taskId=udb5256b5-156f-4a69-b0f1-e9230657791&title=&width=261.5)


<a name="ZAbP4"></a>
### 功能开发
<a name="pyCdy"></a>
#### 登录功能分析
输入用户账户和密码，验证码，然后进行登录校验，通过登录校验后，跳转至首页功能。<br />与此同时，该系统所有用户都必须登录后才能跳转到后台首页，所以，登录功能在全局系统控制器的代码中实现。
<a name="tz2QR"></a>
##### 验证码功能实现
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691465107378-d24f69be-b931-4158-9733-4887fc23ff3b.png#averageHue=%23459efa&clientId=uf1f64081-206c-4&from=paste&height=422&id=ub064ba22&originHeight=844&originWidth=966&originalType=binary&ratio=2&rotation=0&showTitle=false&size=396013&status=done&style=none&taskId=ua7e3502d-daf9-48c5-8dd2-f61b6a018d8&title=&width=483)<br />验证码的前端请求<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691465357331-5b4fe5a8-d2e8-4b3c-b10c-1f293ea79e10.png#averageHue=%23f3f3f3&clientId=uf1f64081-206c-4&from=paste&height=165&id=ud51476ce&originHeight=330&originWidth=1437&originalType=binary&ratio=2&rotation=0&showTitle=false&size=40470&status=done&style=none&taskId=uc625d47d-0e44-4fd6-85a2-5cf8782c49a&title=&width=718.5)<br />请求的是后端方法getVerifiCodeImage，该方法中，先获取请求和响应的参数，获取从工具类中创建的图片，获取图片上的验证码文本，将验证码图片响应给浏览器。
```
@ApiOperation("获取验证码方法")
    @GetMapping("/getVerifiCodeImage")
    public void getVerifiCodeImage(
            @ApiParam("请求") HttpServletRequest request,
            @ApiParam("响应") HttpServletResponse response){

        //获取图片
        BufferedImage verifiCodeImage= CreateVerifiCodeImage.getVerifiCodeImage();

        //获取图片上的验证码
        String verifiCode=new String(CreateVerifiCodeImage.getVerifiCode());

        //将验证码文本放入session 域，为下一次验证做准备
        HttpSession session=request.getSession();
        session.setAttribute("verifiCode",verifiCode);

        /*
        * 将验证码图片响应到浏览器  response输出流
        * 将生成的验证码图片，按照PNG格式传给浏览器。
        * */
        try {
            ServletOutputStream outputStream= response.getOutputStream();
            ImageIO.write(verifiCodeImage,"PNG",outputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
```
<a name="Zsxuu"></a>
##### 登录校验功能
登录校验功能首先需要判断，用户输入的验证码和系统图片的验证码文本是否一致，如若不一致，则会提示验证码有误，请刷新后重试。如若判断一致后，会先将现有session中移除现有验证码，在进行用户类型验证（管理员，学生，老师）。<br />在这里，采用map类型，进行用户响应数据的存放，将传入的用户类型分为三种，1代表管理员，2代表学生，3 代表老师。（以管理员用户为例）将传入的对象，在数据库进行查询，如果查询找到了，则为admin对象。如果没有找到，则admin对象为null，那么说明用户名或者密码错误。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691467497365-e878d984-de53-462c-886d-5a18051f84c1.png#averageHue=%23dfdfcf&clientId=uf1f64081-206c-4&from=paste&height=65&id=u464d4c84&originHeight=361&originWidth=3084&originalType=binary&ratio=2&rotation=0&showTitle=false&size=65851&status=done&style=none&taskId=u13532a5a-fd9d-4d79-bf1b-63048341020&title=&width=557)
```
 /*
     * 登录校验
     * */
    @ApiOperation("登录的方法")
    @PostMapping("/login")
    //传入两个参数，一个是系统的验证码图片，一个是用户输入的验证码
    public Result login(@ApiParam("登录提交的表单")@RequestBody LoginForm loginForm,HttpServletRequest request){

        //验证码
        HttpSession session=request.getSession();
        String sessionVerifiCode=(String) session.getAttribute("verifiCode");
        String loginVerifiCode=loginForm.getVerifiCode();

        //验证码判断,是否失效或者为空
        if ("".equals(sessionVerifiCode ) || null==sessionVerifiCode){
            return  Result.fail().message("验证码失效，请刷新后重试");
        }

        //判断用户输入验证码和系统验证码是否相同，不区分大小写
        if (!sessionVerifiCode.equalsIgnoreCase(loginVerifiCode)){
            return Result.fail().message("验证码有误，请输入后重试");
        }

        //从session移除现有验证码
        session.removeAttribute("verifiCode");

        //分用户类型验证 管理员，学生，老师等
        //准备一个map用户存放响应的数据
        Map<String,Object> map=new LinkedHashMap<>();
        switch (loginForm.getUserType()){
            //管理员表
            case 1:
                try {
                    //传入的对象，判断登录，数据库中查询，找到为admin，如果为null,即没有找到。
                    Admin admin= adminService.login(loginForm);
                    if (null !=admin){
                        //用户的id 和类型，转换为一个密文，以token形式的名称反馈前端
                        String token= JwtHelper.createToken(admin.getId().longValue(),1);
                        map.put("token",token);
                    }else {
                        throw new RuntimeException("用户名或者密码有误");
                    }
                    return Result.ok(map);
                }catch (RuntimeException e){
                    e.printStackTrace();
                    //异常对象抛出来的信息   new RuntimeException("用户名或者密码有误");
                    return Result.fail().message(e.getMessage());
                }

                //学生信息
            case 2:
                try {
                    Student student= studentService.login(loginForm);
                    if (null !=student){
                        String token=JwtHelper.createToken(student.getId().longValue(),2);
                        map.put("token",token);
                    }else {
                        throw new RuntimeException("用户名或者密码错误");
                    }
                    return Result.ok(map);
                }catch (RuntimeException e){
                    e.printStackTrace();
                    return Result.fail().message(e.getMessage());
                }

            case 3:
                try {
                    Teacher teacher= teacherService.login(loginForm);
                    if (null !=teacher){
                        String token=JwtHelper.createToken(teacher.getId().longValue(),3);
                        map.put("token",token);
                    }else {
                        throw new RuntimeException("用户名或者密码错误");
                    }
                    return Result.ok(map);
                }catch (RuntimeException e){
                    e.printStackTrace();
                    return Result.fail().message(e.getMessage());
                }
        }

        return Result.fail().message("查无此人");

    }
```
<a name="D83ip"></a>
##### 登录后跳转功能
在登录过程中，先请求login，再次请求getinfo ，来判断登录页面。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690547634058-52afda64-6236-4380-a7ff-ee610ea9793c.png#averageHue=%2300a745&clientId=u20e54f54-8de1-4&from=paste&height=85&id=uca521c33&originHeight=170&originWidth=3120&originalType=binary&ratio=2&rotation=0&showTitle=false&size=31358&status=done&style=none&taskId=u37c88a2c-2c41-4158-a786-917430d24d0&title=&width=1560)<br />请求login页面：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690548062773-218b81d5-4b95-4195-b017-8c96280f2f0b.png#averageHue=%23fefdfc&clientId=u242ab4e3-5158-4&from=paste&height=134&id=u34045951&originHeight=268&originWidth=1067&originalType=binary&ratio=2&rotation=0&showTitle=false&size=29344&status=done&style=none&taskId=u75041590-4660-4d5c-b19e-6a869c60faf&title=&width=533.5)<br />响应码：200<br />信息：成功<br />data对象：用户id+类型+token有效时间 =>生成密文    <br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690548113825-3926d2c1-123f-4c9b-a81b-5ecebc80d413.png#averageHue=%23fdfafa&clientId=u242ab4e3-5158-4&from=paste&height=128&id=u99cec6f4&originHeight=256&originWidth=1066&originalType=binary&ratio=2&rotation=0&showTitle=false&size=29418&status=done&style=none&taskId=uc46c8113-eee6-42ce-a58f-192d6e6074d&title=&width=533)<br />第二次请求（在login请求成功后，会请求访问getinfo页面）：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690548292000-39c667cc-25fc-46e3-9904-11d6023fc77d.png#averageHue=%23f3f4f4&clientId=u242ab4e3-5158-4&from=paste&height=174&id=XLJ6M&originHeight=347&originWidth=1090&originalType=binary&ratio=2&rotation=0&showTitle=false&size=34445&status=done&style=none&taskId=u29a615db-339d-4b37-bf24-3abab0f2a6a&title=&width=545)<br />第二次请求中也带有一个token。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1691935733234-8e10bea5-96e4-4e9f-9585-472ef7bcf3de.png#averageHue=%23fefefe&clientId=ue1c9555b-2cb0-4&from=ui&id=ue131b3a3&originHeight=337&originWidth=1160&originalType=binary&ratio=2&rotation=0&showTitle=false&size=40377&status=done&style=none&taskId=ua63fe234-9ba8-4b03-a292-42271cadf04&title=)<br />请求信息头：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690548412430-641d44eb-f953-43fa-8d1f-599e9c397046.png#averageHue=%23fdfbfb&clientId=u242ab4e3-5158-4&from=paste&height=257&id=u9f86b118&originHeight=513&originWidth=1137&originalType=binary&ratio=2&rotation=0&showTitle=false&size=88802&status=done&style=none&taskId=u5c377b27-7fc6-4e77-bbce-34fda13af82&title=&width=568.5)<br />响应admin 的数据信息：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690548440252-4ba49958-dd48-4748-a0f0-67ab2f437e62.png#averageHue=%23fdfbfb&clientId=u242ab4e3-5158-4&from=paste&height=327&id=ucda712a1&originHeight=654&originWidth=1152&originalType=binary&ratio=2&rotation=0&showTitle=false&size=72830&status=done&style=none&taskId=ua61c4b6b-4182-4237-9d84-89089fc9546&title=&width=576)<br />源码
```
@Api(tags = "系统控制器")
@RestController
@RequestMapping("/sms/system")
public class SystemController {

    @Autowired
    private AdminService adService;
    @Autowired
    private StudentService studentService;
    @Autowired
    private TeacherService teacherService;


    /*
    * token 判断登录
    * */
    @ApiOperation("通过taken口令来获取当前登录的用户信息的方法")
    @GetMapping("/getInfo")
    public Result getInfoByToken(
            //请求头 token
            @ApiParam("token口令") @RequestHeader("token") String token){
        boolean expiration=JwtHelper.isExpiration(token);//验证token是否过期。
        if (expiration){
            //token无效
            return Result.build(null, ResultCodeEnum.TOKEN_ERROR);
        }
        //从token解析出 用户id+用户类型
        Long userId=JwtHelper.getUserId(token);
        Integer userType=JwtHelper.getUserType(token);

        //判断登录状态
        Map<String,Object> map=new LinkedHashMap<>();
        //用户类型
        switch (userType){
            case 1:
                //根据adminid查询一个对象，键值对
                Admin admin=adminService.getAdminById(userId);
                map.put("userType",1);
                map.put("user",admin);
                break;
            case 2:
                Student student=studentService.getStudentById(userId);
                map.put("userType",2);
                map.put("user",student);
                break;
            case 3:
                Teacher teacher=teacherService.getByTeacherById(userId);
                map.put("userType",3);
                map.put("user",teacher);
                break;
        }
        return Result.ok(map);
    }

}
```

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695196989620-43cb3da0-7930-4da2-abd4-dac367b84d2f.png#averageHue=%23becbbd&clientId=u18a494f2-b0ca-4&from=paste&height=779&id=u3b7252f9&originHeight=1557&originWidth=2211&originalType=binary&ratio=2&rotation=0&showTitle=false&size=175240&status=done&style=none&taskId=uf538a0b7-4965-44db-989c-fb9c3f82870&title=&width=1105.5)

这段代码同时可以优化为以下代码，（后续不少代码给出的是优化后或有一定变动后的代码）
```
@Api(tags = "系统控制器")
@RestController
@RequestMapping("/sms/system")
public class SystemController {

  	private static final int ADMIN_USER_TYPE = 1;
		private static final int STUDENT_USER_TYPE = 2;
		private static final int TEACHER_USER_TYPE = 3;

  	private final AdminService adService;
		private final StudentService studentService;
		private final TeacherService teacherService;

		@Autowired
		public SystemController(AdminService adService, StudentService studentService, TeacherService teacherService) {
    				this.adService = adService;
    				this.studentService = studentService;
    				this.teacherService = teacherService;
			}


    /*
    * token 判断登录
    * */
    @ApiOperation("通过taken口令来获取当前登录的用户信息的方法")
    @GetMapping("/getInfo")
    public Result getInfoByToken(
            //请求头 token
            @ApiParam("token口令") @RequestHeader("token") String token){
        boolean isTokenExpired=JwtHelper.isExpiration(token);//验证token是否过期。
        if (isTokenExpired){
            //token无效
            return Result.build(null, ResultCodeEnum.TOKEN_ERROR);
        }
        //从token解析出 用户id+用户类型
        Long userId=JwtHelper.getUserId(token);
        Integer userType=JwtHelper.getUserType(token);

        //判断登录状态
        Map<String,Object> map=new LinkedHashMap<>();
        //用户类型


				if (userType == ADMIN_USER_TYPE) {
    			// 处理管理员用户逻辑
        	Admin admin=adminService.getAdminById(userId);
                map.put("userType",1);
                map.put("user",admin);
                break;
				} else if (userType == STUDENT_USER_TYPE) {
    			// 处理学生用户逻辑
        	Student student=studentService.getStudentById(userId);
                map.put("userType",2);
                map.put("user",student);
                break;
				} else if (userType == TEACHER_USER_TYPE) {
   			 // 处理教师用户逻辑
        	Teacher teacher=teacherService.getByTeacherById(userId);
                map.put("userType",3);
                map.put("user",teacher);
                break;
				} else {
    		// 处理其他用户类型逻辑
          	 return Result.ok(map);
				}

}
```
<a name="s1M6l"></a>
#### 系统管理器实现
<a name="avFdz"></a>
##### 验证码响应图片功能实现
验证码图片请求<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695266281428-94816844-4854-4ba9-bd9d-4e4733856757.png#averageHue=%23d5e2c8&clientId=ue76cf919-cd34-4&from=paste&height=164&id=u34e1585a&originHeight=327&originWidth=1667&originalType=binary&ratio=2&rotation=0&showTitle=false&size=47408&status=done&style=none&taskId=u3f1e3bc2-16e5-4c45-a00b-ae9fad208d4&title=&width=833.5)<br />Controller层代码
```
/*
    * 响应验证码图片的流程
    * 匹配处理器方法路径
    * */
    @ApiOperation("获取验证码方法")
    @GetMapping("/getVerifiCodeImage")
    public void getVerifiCodeImage(
            @ApiParam("请求") HttpServletRequest request,
            @ApiParam("响应") HttpServletResponse response){

        //获取图片
        BufferedImage verifiCodeImage= CreateVerifiCodeImage.getVerifiCodeImage();

        //获取图片上的验证码
        String verifiCode=new String(CreateVerifiCodeImage.getVerifiCode());

        //将验证码文本放入session 域，为下一次验证做准备
        HttpSession session=request.getSession();
        session.setAttribute("verifiCode",verifiCode);

        /*
        * 将验证码图片响应到浏览器  response输出流
        * 将生成的验证码图片，按照PNG格式传给浏览器。
        * */
        try {
            ServletOutputStream outputStream= response.getOutputStream();
            ImageIO.write(verifiCodeImage,"PNG",outputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
```
响应验证码图片<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695266364866-453f1baa-e15c-4ce5-848a-d4a2071581f0.png#averageHue=%23fdfdfd&clientId=ue76cf919-cd34-4&from=paste&height=137&id=u15fb1b24&originHeight=273&originWidth=1835&originalType=binary&ratio=2&rotation=0&showTitle=false&size=31072&status=done&style=none&taskId=u1f0cd759-dedd-4e3b-9ddb-9e3beb11c5e&title=&width=917.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695266716056-75029a06-1afb-4cfc-a460-d6337fba307e.png#averageHue=%23e8f1f8&clientId=ue76cf919-cd34-4&from=paste&height=422&id=u63e4c5df&originHeight=843&originWidth=1923&originalType=binary&ratio=2&rotation=0&showTitle=false&size=94711&status=done&style=none&taskId=u30beb2e0-768c-4aa8-b75a-ffe82a2d120&title=&width=961.5)
<a name="AyD5V"></a>
##### 异步图片上传头像功能实现
该操作响应流程<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695266520354-d225a18e-7724-4863-b528-f42ff2fca044.png#averageHue=%23ada991&clientId=ue76cf919-cd34-4&from=paste&height=168&id=u25dc8dbb&originHeight=335&originWidth=1493&originalType=binary&ratio=2&rotation=0&showTitle=false&size=46889&status=done&style=none&taskId=u4691c8bb-4684-4c5d-965e-8a436504e24&title=&width=746.5)<br />Controller层代码
```
@ApiOperation("文件上传统一入口")
@PostMapping("/headerImgUpload")
public Result headerImgUpload(
        @ApiParam("头像文件") @RequestParam("file") MultipartFile file,
        HttpServletRequest request
) {
    if (file.isEmpty()) {
        return Result.error("文件为空");
    }

    String uuid = UUID.randomUUID().toString().replace("-", "").toLowerCase();
    String originalFilename = file.getOriginalFilename();
    String fileExtension = originalFilename.substring(originalFilename.lastIndexOf("."));
    String newFileName = uuid + fileExtension;

    String uploadDirectory = "D:/ideaProjects/smart_campus/target/classes/public/upload/";
    String portraitPath = uploadDirectory + newFileName;

    try {
        Files.createDirectories(Paths.get(uploadDirectory));
        file.transferTo(new File(portraitPath));
    } catch (IOException e) {
        e.printStackTrace();
        return Result.error("文件上传失败");
    }

    String path = "upload/" + newFileName;
    return Result.ok(path);
}
```
该操作响应成功<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695266566279-75f3efa5-ad42-4d70-bcbe-e05aeb2d745d.png#averageHue=%23c4b3a3&clientId=ue76cf919-cd34-4&from=paste&height=140&id=u1dc0060e&originHeight=279&originWidth=1355&originalType=binary&ratio=2&rotation=0&showTitle=false&size=41351&status=done&style=none&taskId=u7d4681fc-8f7e-49ab-b845-5bcd8a0c0df&title=&width=677.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695266731639-cb3e7a4b-b08a-4a51-a2d9-8d04a0da132e.png#averageHue=%23e8f6ee&clientId=ue76cf919-cd34-4&from=paste&height=660&id=u89c45b13&originHeight=1319&originWidth=1907&originalType=binary&ratio=2&rotation=0&showTitle=false&size=134823&status=done&style=none&taskId=u8e7e13f6-6b89-46ba-8695-32409973857&title=&width=953.5)
<a name="VRJr8"></a>
##### 全局修改密码功能实现
Controller层代码
```
@ApiOperation("全局密码更新器")
@PostMapping("/updatePwd/{oldPwd}/{newPwd}")
public Result updatePwd(
        @ApiParam("token口令") @RequestHeader("token") String token,
        @ApiParam("旧密码") @PathVariable("oldPwd") String oldPwd,
        @ApiParam("新密码") @PathVariable("newPwd") String newPwd
) {
    boolean expiration = JwtHelper.isExpiration(token);
    if (expiration) {
        // token 过期
        return Result.fail().message("token过期，请重新登录");
    }

    // 获取用户id和用户类型
    Long userId = JwtHelper.getUserId(token);
    Integer userType = JwtHelper.getUserType(token);

    // 定义用户实体类和服务类
    BaseUser user = null;
    BaseService<BaseUser> userService = null;

    // 根据用户类型选择对应的实体类和服务类
    switch (userType) {
        case 1:
            user = adminService.getById(userId);
            userService = adminService;
            break;
        case 2:
            user = studentService.getById(userId);
            userService = studentService;
            break;
        case 3:
            user = teacherService.getById(userId);
            userService = teacherService;
            break;
    }

    // 验证用户和密码
    if (user != null && user.getPassword().equals(MD5.encrypt(oldPwd))) {
        // 修改密码
        user.setPassword(MD5.encrypt(newPwd));
        userService.saveOrUpdate(user);
        return Result.ok().message("密码修改成功");
    } else {
        return Result.fail().message("原密码有误！");
    }
}
```
swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695266794054-2e1d96ba-178a-48d3-b60f-98607b763b93.png#averageHue=%23e9f6ee&clientId=ue76cf919-cd34-4&from=paste&height=674&id=u8b68efc6&originHeight=1347&originWidth=1937&originalType=binary&ratio=2&rotation=0&showTitle=false&size=129572&status=done&style=none&taskId=u3c8db7b8-fe94-4565-b5fd-534958f4656&title=&width=968.5)
<a name="uOkQX"></a>
#### 管理员管理功能实现
进入管理员管理界面<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695197640348-6ec652fc-9360-42b4-b88a-f31df59ba9eb.png#averageHue=%23e2b168&clientId=u18a494f2-b0ca-4&from=paste&height=652&id=u5a412527&originHeight=1304&originWidth=2767&originalType=binary&ratio=2&rotation=0&showTitle=false&size=179855&status=done&style=none&taskId=u4d22de60-c943-4135-9e9d-a8ec87e6264&title=&width=1383.5)

<a name="vCaTa"></a>
##### 查询管理员信息
先看查询数据流的请求信息<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695198071092-e922352a-0e7c-4e8f-b7c2-1319927ed3f1.png#averageHue=%23f4f4f4&clientId=u18a494f2-b0ca-4&from=paste&height=180&id=u58366aaf&originHeight=359&originWidth=2597&originalType=binary&ratio=2&rotation=0&showTitle=false&size=52048&status=done&style=none&taskId=u52e3cc60-1ecc-49c2-a4b4-b5e1092521a&title=&width=1298.5)<br />根据请求路径，到后端请求地址<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695198175582-8de711a1-bd23-4f41-8abd-3ac860a47ade.png#averageHue=%23fcfbf9&clientId=u18a494f2-b0ca-4&from=paste&height=113&id=uffae2816&originHeight=225&originWidth=929&originalType=binary&ratio=2&rotation=0&showTitle=false&size=41351&status=done&style=none&taskId=uad4c74e4-7889-470f-98f6-ccb0e4fe23b&title=&width=464.5)<br />Controller层代码
```
@Autowired
private AdminService adminService;

/*
* /sms/adminController/getAllAdmin/1/3
* 分页查询
* */

@ApiOperation("分页查询功能")
@GetMapping("/getAllAdmin/{pageNo}/{pageSize}")
public Result getAllAdmin(
        @ApiParam("页码") @PathVariable("pageNo") Integer pageNo,
        @ApiParam("页大小") @PathVariable("pageSize") Integer pageSize,
        @ApiParam("管理员名字") String adminName
){

    Page<Admin> page = new Page<>(pageNo, pageSize);
    IPage<Admin> iPage = adminService.getAdminsByOpr(page, adminName);
    return Result.ok(iPage);
}

```
service层代码
```
@Override
public IPage<Admin> getAdminsByOpr(Page<Admin> page, String adminName) {
    QueryWrapper<Admin> queryWrapper = new QueryWrapper<>();
    if (!StringUtils.isEmpty(adminName)) {
        queryWrapper.like("name", adminName);
    }
    queryWrapper.orderByDesc("id");

    return baseMapper.selectPage(page, queryWrapper);
}

```
该请求响应为：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695199291712-2c51eb8c-b7e1-4c80-9dba-04aaae9b4a05.png#averageHue=%23fffef1&clientId=u18a494f2-b0ca-4&from=paste&height=318&id=u8e8708ed&originHeight=635&originWidth=2787&originalType=binary&ratio=2&rotation=0&showTitle=false&size=86267&status=done&style=none&taskId=u2ccf2c1d-1c40-4137-b593-54df33b2975&title=&width=1393.5)<br />swagger测试接口：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695199349302-faf19dad-a512-4a27-a1dd-56456ec0bf0b.png#averageHue=%23b1cec7&clientId=u18a494f2-b0ca-4&from=paste&height=722&id=u6f841965&originHeight=1444&originWidth=1957&originalType=binary&ratio=2&rotation=0&showTitle=false&size=131485&status=done&style=none&taskId=uf8d15886-508f-4a60-b0b9-4ec9dd5da34&title=&width=978.5)

<a name="cNcH8"></a>
##### 添加和修改管理员信息
弹出添加表单，填写相关信息。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695208953852-7b09bf5f-3974-4d42-9a61-a911a6cc7403.png#averageHue=%23fefefe&clientId=u18a494f2-b0ca-4&from=paste&height=670&id=uad6c3305&originHeight=1761&originWidth=1239&originalType=binary&ratio=2&rotation=0&showTitle=false&size=98576&status=done&style=none&taskId=ub0e25566-e58a-4449-9aab-ee57abb3fbb&title=&width=471.5)<br />数据流请求地址<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695208929730-0d54a1d7-952f-4eaf-a2a7-f6c75631c267.png#averageHue=%23f4f5f5&clientId=u18a494f2-b0ca-4&from=paste&height=136&id=u8d7b150b&originHeight=271&originWidth=1147&originalType=binary&ratio=2&rotation=0&showTitle=false&size=30183&status=done&style=none&taskId=ud696d829-e8c5-494e-ac05-418bc5de5f0&title=&width=573.5)

Controller层代码
```
@ApiOperation("增加或者修改管理员信息")
@PostMapping("/saveOrUpdateAdmin")
public Result saveOrUpdateAdmin(@ApiParam("JSON格式的Admin对象") @RequestBody Admin admin) {
    if (admin.getId() == null || admin.getId() == 0) {
        admin.setPassword(MD5.encrypt(admin.getPassword()));
    }
    adminService.saveOrUpdate(admin);
    return Result.ok();
}

```

> 在这里区分一下增加和修改操作。
> 1. admin 对象的 id 是否为 null 或者为 0。如果是，则表示这是一个新增的管理员，需要对密码进行加密处理。
> 2. 如果 id 不为 null 或者不为 0，则表示这是一个修改操作，不需要对密码进行处理。


请求响应头<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695209969203-1f6aca75-3484-4aba-9ed2-6e2947e52367.png#averageHue=%23fefcfc&clientId=u18a494f2-b0ca-4&from=paste&height=210&id=u6e892e85&originHeight=419&originWidth=1735&originalType=binary&ratio=2&rotation=0&showTitle=false&size=64719&status=done&style=none&taskId=ua77af74a-2ac4-49d1-a798-e3a082312a8&title=&width=867.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695209793043-8e535a81-68a0-4a19-b74a-7b01c96c9bd2.png#averageHue=%23e9f6ee&clientId=u18a494f2-b0ca-4&from=paste&height=786&id=u221bffb4&originHeight=1571&originWidth=1905&originalType=binary&ratio=2&rotation=0&showTitle=false&size=164515&status=done&style=none&taskId=u99cdbd54-27ad-45db-91cf-b3f19c7ed77&title=&width=952.5)
<a name="pY6Xz"></a>
##### 删除和批量删除管理员信息
删除操作请求数据流<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695210144485-c59e311f-77d9-4b92-816e-ea8da41e6ac9.png#averageHue=%23d8c9b5&clientId=u18a494f2-b0ca-4&from=paste&height=176&id=u0e4b691e&originHeight=351&originWidth=2227&originalType=binary&ratio=2&rotation=0&showTitle=false&size=49688&status=done&style=none&taskId=u9bee58d2-f720-4243-aa36-cdea5e6d13b&title=&width=1113.5)<br />Controller层代码
```
@ApiOperation("删除单个用户或者批量删除多个用户")
@DeleteMapping("/deleteAdmin")
public Result deleteAdmin(@ApiParam("删除管理员用户的id的JSON集合") @RequestBody List<Integer> ids) {
    if (ids.size() == 1) {
        // 单一删除逻辑
        adminService.removeById(ids.get(0));
    } else {
        // 批量删除逻辑
        adminService.removeByIds(ids);
    }
    return Result.ok();
}
```
> 通过判断ids列表的长度，来区分是单一删除还是批量删除
> 如果长度为1，则执行单一删除逻辑，调用adminService.removeById(ids.get(0))方法删除对应的管理员用户；
> 如果长度大于1，则执行批量删除逻辑，调用adminService.removeByIds(ids)方法删除对应的管理员用户。

该请求响应操作<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695210309626-2adfa426-02fe-4d1d-9340-5a9f52c4c087.png#averageHue=%23fbf4d1&clientId=u18a494f2-b0ca-4&from=paste&height=81&id=ued9e81c1&originHeight=161&originWidth=1935&originalType=binary&ratio=2&rotation=0&showTitle=false&size=23510&status=done&style=none&taskId=ue82e7a8a-6c6f-46fd-ba16-2c410719828&title=&width=967.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695210576211-f2a0b27e-555e-48b1-8ce6-c3d8fa059c15.png#averageHue=%23f7f0e7&clientId=u18a494f2-b0ca-4&from=paste&height=854&id=u29f8d00a&originHeight=1707&originWidth=1937&originalType=binary&ratio=2&rotation=0&showTitle=false&size=162940&status=done&style=none&taskId=uc353abc8-83a8-4265-bbcc-26b694b03d5&title=&width=968.5)


<a name="vrdhV"></a>
#### 年级管理功能实现
<a name="wXWxH"></a>
##### 查询年级信息

先查询数据流的请求信息<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695211082802-d280d886-4b90-4d87-ac09-135e052ed3dc.png#averageHue=%23f4f5f5&clientId=u18a494f2-b0ca-4&from=paste&height=171&id=ud8a58410&originHeight=341&originWidth=2223&originalType=binary&ratio=2&rotation=0&showTitle=false&size=53476&status=done&style=none&taskId=ub3b134b9-5636-4271-954c-924df7785f3&title=&width=1111.5)

根据请求路径，到后端请求地址<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695211771440-142ae230-d0b4-4b45-81dc-4d53aedd6a2f.png#averageHue=%23f9f8f0&clientId=u18a494f2-b0ca-4&from=paste&height=97&id=u7daf6dab&originHeight=193&originWidth=939&originalType=binary&ratio=2&rotation=0&showTitle=false&size=41918&status=done&style=none&taskId=u591ab214-567a-4609-8541-212f86d0f35&title=&width=469.5)

Controller层代码
```
@Api(tags = "年级控制器")
@RestController
@RequestMapping("/sms/gradeController")
public class GradeController {

    private final GradeService gradeService;

    public GradeController(GradeService gradeService) {
        this.gradeService = gradeService;
    }

    @ApiOperation("查询年级信息，分页带条件")
    @GetMapping("/getGrades")
    public Result getGrades(
            @ApiParam("分页查询页码数") @RequestParam(value = "pageNo", defaultValue = "1") Integer pageNo,
            @ApiParam("分页查询页大小") @RequestParam(value = "pageSize", defaultValue = "10") Integer pageSize,
            @ApiParam("分页查询模糊匹配班级名") @RequestParam(value = "gradeName", required = false) String gradeName) {
        Page<Grade> page = new Page<>(pageNo, pageSize);
        IPage<Grade> pageRs = gradeService.getGradeByOpr(page, gradeName);
        return Result.ok(pageRs);
    }
}
```

Service层代码
```
@Service
@Transactional
public class GradeServiceImpl extends ServiceImpl<GradeMapper, Grade> implements GradeService {
    private final GradeMapper gradeMapper;

    public GradeServiceImpl(GradeMapper gradeMapper) {
        this.gradeMapper = gradeMapper;
    }

    @Override
    public IPage<Grade> getGradeByOpr(Page<Grade> pageParam, String gradeName) {
        // 设置查询条件
        QueryWrapper<Grade> queryWrapper = new QueryWrapper<>();
        if (!StringUtils.isEmpty(gradeName)) {
            queryWrapper.like("name", gradeName);
        }
        // 设置排序规则
        queryWrapper.orderByDesc("id");
        queryWrapper.orderByAsc("name");
        // 分页查询数据
        IPage<Grade> page = gradeMapper.selectPage(pageParam, queryWrapper);

        return page;
    }
}
```

该请求响应头<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695212599357-a98293ca-bc6b-4299-9a94-18b8df64b515.png#averageHue=%23fefdfd&clientId=u18a494f2-b0ca-4&from=paste&height=211&id=u5d0fd1db&originHeight=421&originWidth=1341&originalType=binary&ratio=2&rotation=0&showTitle=false&size=59195&status=done&style=none&taskId=ueda6fd42-c479-4000-9570-3f787bb8fe6&title=&width=670.5)

swagger测试接口功能<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695212669481-a93d546b-3fda-4f87-9578-1c89dca1ed4b.png#averageHue=%23aec8c4&clientId=u18a494f2-b0ca-4&from=paste&height=777&id=ubae82ec6&originHeight=1553&originWidth=1911&originalType=binary&ratio=2&rotation=0&showTitle=false&size=165561&status=done&style=none&taskId=u22c1d399-3087-44c1-a12d-6bc228408c8&title=&width=955.5)

<a name="lxgnH"></a>
##### 添加和修改年级信息
添加年级表单，填入数据。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695213025165-2576f484-7897-4fe3-b7b9-ac54ce2bf4a5.png#averageHue=%23fefefe&clientId=u18a494f2-b0ca-4&from=paste&height=499&id=u07fbc1e3&originHeight=997&originWidth=1263&originalType=binary&ratio=2&rotation=0&showTitle=false&size=77611&status=done&style=none&taskId=uf3cb7fb5-643a-4c00-b8b7-852069aae00&title=&width=631.5)

数据流的请求头<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695213108320-6a97ea11-4c38-4e19-ba79-5d1d04482108.png#averageHue=%23f5f6f6&clientId=u18a494f2-b0ca-4&from=paste&height=162&id=uc550d77e&originHeight=323&originWidth=2595&originalType=binary&ratio=2&rotation=0&showTitle=false&size=53052&status=done&style=none&taskId=u7ccfc3fa-b9d8-4b10-955e-54e52b53697&title=&width=1297.5)

Controller层代码
```
@Api(tags = "年级控制器")
@RestController
@RequestMapping("/sms/gradeController")
public class GradeController {

    private final GradeService gradeService;

    @Autowired
    public GradeController(GradeService gradeService) {
        this.gradeService = gradeService;
    }

    @ApiOperation("添加或者修改年级信息")
    @PostMapping("/saveOrUpdateGrade")
    public Result saveOrUpdateGrade(@ApiParam("JSON的grade对象转换后台数据模型") @RequestBody Grade grade) {
        // 调用服务层方法，实现添加或者修改年级信息
        gradeService.saveOrUpdate(grade);
        return Result.ok();
    }
}

```
swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695213580567-3a7f87ce-3a44-485c-9ce4-d7b95a57a99f.png#averageHue=%23eff8e8&clientId=u18a494f2-b0ca-4&from=paste&height=756&id=ue6bddee4&originHeight=1511&originWidth=1933&originalType=binary&ratio=2&rotation=0&showTitle=false&size=164760&status=done&style=none&taskId=ub0088b44-7cdc-4c1f-bcbc-ea83237cd14&title=&width=966.5)

<a name="Oj9gX"></a>
##### 删除和批量删除年级信息
删除操作请求数据流<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695213939925-0dd341ac-8331-42ca-a9ec-2fbe393f6208.png#averageHue=%23f4f5f5&clientId=u18a494f2-b0ca-4&from=paste&height=163&id=u7f48f0aa&originHeight=325&originWidth=1855&originalType=binary&ratio=2&rotation=0&showTitle=false&size=43555&status=done&style=none&taskId=u6c9177e5-9bba-4637-ab29-68bbca3f62c&title=&width=927.5)<br />Controller层代码
```
private final GradeService gradeService;

public GradeController(GradeService gradeService) {
    this.gradeService = gradeService;
}

@ApiOperation("删除一个或者多个grade信息")
@DeleteMapping("/deleteGrade")
public Result deleteGradeById(
        @ApiParam("JSON的年级id集合,映射为后台List<Integer>") @RequestBody List<Integer> ids
) {
    gradeService.removeByIds(ids);
    return Result.ok();
}
```
请求后的响应<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695214131030-14891f06-1479-4e9b-a78b-70515782ab3c.png#averageHue=%23e3c393&clientId=u18a494f2-b0ca-4&from=paste&height=110&id=u1d866f07&originHeight=219&originWidth=1307&originalType=binary&ratio=2&rotation=0&showTitle=false&size=22496&status=done&style=none&taskId=u0901790b-50ab-49e4-b7ef-ebd129df1fc&title=&width=653.5)

swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695213987542-6eec890f-c139-44b4-b937-e76ea5f53899.png#averageHue=%23f8f2e6&clientId=u18a494f2-b0ca-4&from=paste&height=647&id=u5dc943a0&originHeight=1293&originWidth=1935&originalType=binary&ratio=2&rotation=0&showTitle=false&size=116821&status=done&style=none&taskId=u55281add-aeeb-4874-8bc0-10e6e229579&title=&width=967.5)

<a name="ciA6o"></a>
#### 班级管理功能实现
<a name="ONFRk"></a>
##### 搜索条件中的年级选项
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695214458525-dca949b9-7cc1-4a3e-bbfa-c18819e8e54b.png#averageHue=%23faf9f9&clientId=u18a494f2-b0ca-4&from=paste&height=205&id=u4d4b05c8&originHeight=409&originWidth=1961&originalType=binary&ratio=2&rotation=0&showTitle=false&size=71172&status=done&style=none&taskId=u2ff21d6b-8f5c-4eb9-848a-c76b46eac65&title=&width=980.5)

Controller层代码
```
@Api(tags = "年级控制器")
@RestController
@RequestMapping("/sms/gradeController")
public class GradeController {

    @Autowired
    private GradeService gradeService;


    @ApiOperation("获取所有Grade信息")
    @GetMapping("/getGrades")
    public Result getGrades(){
        List<Grade> grades = gradeService.getGrades();
        return Result.ok(grades);
    }
}
```
service层代码
```
@Service
@Transactional
public class GradeServiceImpl extends ServiceImpl<GradeMapper, Grade> implements GradeService {
 	public List<Grade> getGrades(){
        List<Grade> grades = baseMapper.selectList(null);
        return grades;
    }
}
```
mapper层代码
```
public interface BaseMapper<T> extends Mapper<T>{
    List<T> selectList(@Param("ew") Wrapper<T> queryWrapper);
}
```
swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695214899755-31aa0920-022b-4b52-8e8d-a57af9930b28.png#averageHue=%23b2c8bb&clientId=u18a494f2-b0ca-4&from=paste&height=571&id=uf2b09a4e&originHeight=1141&originWidth=1927&originalType=binary&ratio=2&rotation=0&showTitle=false&size=101099&status=done&style=none&taskId=u3281918c-995a-40ed-93e9-0265019da1b&title=&width=963.5)

<a name="kLPGP"></a>
##### 查询班级信息
先看查询数据流的请求信息<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695214251225-a3e626a0-dced-4d77-b8d4-7156fa47c5ab.png#averageHue=%23f4f5f5&clientId=u18a494f2-b0ca-4&from=paste&height=163&id=u7c934f80&originHeight=325&originWidth=2331&originalType=binary&ratio=2&rotation=0&showTitle=false&size=54872&status=done&style=none&taskId=ua65b9d07-baf0-4b3c-b39f-1e96fceb7e3&title=&width=1165.5)

根据请求路径，到后端请求地址<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695214321836-eec0542a-f599-4c5b-b951-4f71f342fc4e.png#averageHue=%23fbfbf9&clientId=u18a494f2-b0ca-4&from=paste&height=104&id=ua968019c&originHeight=207&originWidth=1205&originalType=binary&ratio=2&rotation=0&showTitle=false&size=45611&status=done&style=none&taskId=ub71522ce-44f0-4ece-aeb9-8a385d022ce&title=&width=602.5)

Controller层代码
```
@Api(tags = "班级控制器")
@RestController
@RequestMapping("/sms/clazzController")
public class ClazzController {

    @Autowired
    private ClazzService clazzService;

    @ApiOperation("查询班级信息,分页带条件")
    @GetMapping("/getClazzsByOpr/{pageNo}/{pageSize}")
    public Result getClazzsByOpr(
            @ApiParam("页码数")  @PathVariable("pageNo") Integer pageNo,
            @ApiParam("页大小")  @PathVariable("pageSize") Integer pageSize,
            @ApiParam("查询条件") Clazz clazz
    ){
        //设置分页信息
        Page<Clazz> page =new Page<>(pageNo,pageSize);
        IPage<Clazz> iPage = clazzService.getClazzsByOpr(page, clazz);
        return Result.ok(iPage);
    }

}
```
service层代码
```
@Service
@Transactional
public class ClazzServiceImpl extends ServiceImpl<ClazzMapper, Clazz> implements ClazzService {
    /**
     * 分页查询所有班级信息【带条件】
     * @param clazz
     * @return
     */
    @Override
    public IPage<Clazz> getClazzsByOpr(Page<Clazz> pageParam,Clazz clazz) {
        QueryWrapper queryWrapper = new QueryWrapper();
        if(clazz != null){
            //年级名称条件
            String gradeName = clazz.getGradeName();
            if(!StringUtils.isEmpty(gradeName)){
                queryWrapper.eq("grade_name",gradeName);
            }
            //班级名称条件
            String clazzName = clazz.getName();
            if(!StringUtils.isEmpty(clazzName)){
                queryWrapper.like("name",clazzName);
            }
            queryWrapper.orderByDesc("id");
            queryWrapper.orderByAsc("name");
        }
        Page page = baseMapper.selectPage(pageParam, queryWrapper);
        return page;
    }
}
```

该请求响应头<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215087411-f7b8fb82-02e3-43d4-99bb-da1227b62000.png#averageHue=%23fefdfd&clientId=u18a494f2-b0ca-4&from=paste&height=245&id=u2586131a&originHeight=489&originWidth=1357&originalType=binary&ratio=2&rotation=0&showTitle=false&size=67055&status=done&style=none&taskId=u7238cfb0-604b-4b44-ac34-da622c22cf3&title=&width=678.5)

swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215120215-98ac6cd2-82be-42b7-8e0b-6ca75cc6aac7.png#averageHue=%23afcac4&clientId=u18a494f2-b0ca-4&from=paste&height=690&id=udec7f964&originHeight=1379&originWidth=1949&originalType=binary&ratio=2&rotation=0&showTitle=false&size=146365&status=done&style=none&taskId=u60844320-ef0a-4a63-8967-284b3b43612&title=&width=974.5)

<a name="TvHiB"></a>
##### 添加和修改班级信息
填写表单，添加数据<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215282714-81fc386d-6247-4450-b1aa-b404f28c4bfa.png#averageHue=%23fefefe&clientId=u18a494f2-b0ca-4&from=paste&height=515&id=u4c85dc8d&originHeight=1211&originWidth=1087&originalType=binary&ratio=2&rotation=0&showTitle=false&size=101356&status=done&style=none&taskId=u57c947f4-179f-4e8e-b70b-485ed3d9613&title=&width=462.5)

该数据流请求头<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215405261-460efde7-2bd9-4d97-bce0-b6e18f3716f0.png#averageHue=%23f3f3f4&clientId=u18a494f2-b0ca-4&from=paste&height=164&id=ucbedc6cb&originHeight=327&originWidth=1605&originalType=binary&ratio=2&rotation=0&showTitle=false&size=48498&status=done&style=none&taskId=u57ab8e81-c5e1-4179-8f4f-5e97d715791&title=&width=802.5)<br />Controller层代码
```
@Api(tags = "班级控制器")
@RestController
@RequestMapping("/sms/clazzController")
public class ClazzController {

    @Autowired
    private ClazzService clazzService;

    @ApiOperation("保存或者修改班级信息")
    @PostMapping("/saveOrUpdateClazz")
    public Result saveOrUpdateClazz(
            @ApiParam("JSON转换后端Clazz数据模型") @RequestBody Clazz clazz
    ){
        clazzService.saveOrUpdate(clazz);
        return Result.ok();
    }
}
```

请求响应后<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215577002-a63e1968-5cd4-4e46-8ca7-4f9661ddc437.png#averageHue=%23fbfbde&clientId=u18a494f2-b0ca-4&from=paste&height=81&id=u4ea66895&originHeight=161&originWidth=1295&originalType=binary&ratio=2&rotation=0&showTitle=false&size=28037&status=done&style=none&taskId=u0942c383-e68d-4226-8f55-f47ce49c6e2&title=&width=647.5)<br />增加<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215661425-63c9624c-202c-498e-b254-820d45e4ae6c.png#averageHue=%23fefdfd&clientId=u18a494f2-b0ca-4&from=paste&height=182&id=uffd7830b&originHeight=363&originWidth=2093&originalType=binary&ratio=2&rotation=0&showTitle=false&size=73647&status=done&style=none&taskId=u2c3235e3-435f-46ab-8d3d-2471767bf4c&title=&width=1046.5)<br />修改<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215650329-39290138-1493-4277-b66c-8e8bfc458535.png#averageHue=%23fdfcfb&clientId=u18a494f2-b0ca-4&from=paste&height=230&id=u72422edb&originHeight=459&originWidth=1875&originalType=binary&ratio=2&rotation=0&showTitle=false&size=78856&status=done&style=none&taskId=ue7f29b58-72ac-40c8-98c8-99345a7d262&title=&width=937.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215520969-26679da2-a882-4cc7-a9d4-94ed34164ebd.png#averageHue=%23fbf5da&clientId=u18a494f2-b0ca-4&from=paste&height=334&id=u939d4a10&originHeight=667&originWidth=1907&originalType=binary&ratio=2&rotation=0&showTitle=false&size=62835&status=done&style=none&taskId=u8de54897-5ae3-4355-bebe-ba89892d039&title=&width=953.5)
<a name="lYj8M"></a>
##### 删除和批量删除班级信息
删除响应：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215717747-72d93928-8f43-4853-8c28-0d8485739723.png#averageHue=%23f3f4f4&clientId=u18a494f2-b0ca-4&from=paste&height=170&id=u523681ae&originHeight=339&originWidth=1731&originalType=binary&ratio=2&rotation=0&showTitle=false&size=43428&status=done&style=none&taskId=u5ba73416-cf36-44f0-8de9-e0f3092cc58&title=&width=865.5)<br />Controller层代码
```
public class ClazzController {
private final ClazzService clazzService;

public ClazzController(ClazzService clazzService) {
    this.clazzService = clazzService;
}

@ApiOperation("删除一个或者多个班级信息")
@DeleteMapping("/deleteClazz")
public Result deleteClazzByIds(
        @ApiParam("多个班级id的JSON") @RequestBody List<Integer> ids
){
    clazzService.removeByIds(ids);
    return Result.ok();
	}
}
```
请求响应后<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215828155-be041f52-96b9-4b8f-90ad-a7262289c0b5.png#averageHue=%23fbfbde&clientId=u18a494f2-b0ca-4&from=paste&height=76&id=u4f0fc7fe&originHeight=151&originWidth=1227&originalType=binary&ratio=2&rotation=0&showTitle=false&size=21484&status=done&style=none&taskId=u0a836bc0-c288-47a3-91ba-929fea7a389&title=&width=613.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695215874749-834c5900-5468-4deb-bd05-b3813d290614.png#averageHue=%23f8f2e4&clientId=u18a494f2-b0ca-4&from=paste&height=518&id=uccc35f0c&originHeight=1035&originWidth=1919&originalType=binary&ratio=2&rotation=0&showTitle=false&size=90407&status=done&style=none&taskId=u4e572569-92f1-400c-beca-b41976bc4dc&title=&width=959.5)

<a name="uRtxZ"></a>
#### 教师管理功能实现
<a name="PWTus"></a>
##### 搜索条件中班级选项
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695261968503-fcfe6620-d48d-4be6-897f-aa83b19a98bf.png#averageHue=%23fefdfd&clientId=ue76cf919-cd34-4&from=paste&height=309&id=u16e448b8&originHeight=617&originWidth=1765&originalType=binary&ratio=2&rotation=0&showTitle=false&size=64788&status=done&style=none&taskId=udb432616-3651-4c1a-8215-bdc1bb4a677&title=&width=882.5)

Controller层代码
```
//查询所有班级信息
    @ApiOperation("查询所有班级的信息")
    @GetMapping("/getClazzs")
    public Result getClazzs(){
        List<Clazz> clazzes=clazzService.getClazzs();
        return Result.ok(clazzes);
    }
```
service层代码
```
@Service("clazzServiceImpl")
@Transactional //事务控制
public class ClazzServiceImpl extends ServiceImpl<ClazzMapper, Clazz> implements ClazzService {
    @Override
    public List<Clazz> getClazzs() {
        return baseMapper.selectList(null);
    }

}
```
swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695262855220-d7608278-ddd6-48ab-af71-f3cc738d6d4c.png#averageHue=%23b8ccbf&clientId=ue76cf919-cd34-4&from=paste&height=548&id=u37baa331&originHeight=1095&originWidth=1913&originalType=binary&ratio=2&rotation=0&showTitle=false&size=100891&status=done&style=none&taskId=u3cd8dc1b-d8f1-4370-b1ff-b2b51c507f2&title=&width=956.5)
<a name="aPfit"></a>
##### 查询教师功能实现
先查询数据流的请求信息<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695262931205-abd8ec7c-9446-4e8f-934a-707a82efbb82.png#averageHue=%23fefefe&clientId=ue76cf919-cd34-4&from=paste&height=136&id=u74633add&originHeight=271&originWidth=2443&originalType=binary&ratio=2&rotation=0&showTitle=false&size=45966&status=done&style=none&taskId=u17afb43a-4fbd-48d6-b7d4-5834cc4bf03&title=&width=1221.5)<br />根据请求路径，到后端请求地址<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695262986559-20e04f93-7fcc-4561-8d32-e1dc15f22b91.png#averageHue=%23faf8f2&clientId=ue76cf919-cd34-4&from=paste&height=106&id=u47892164&originHeight=211&originWidth=1013&originalType=binary&ratio=2&rotation=0&showTitle=false&size=41792&status=done&style=none&taskId=u4998608d-efac-47a3-b03a-e1ddc8cc50c&title=&width=506.5)<br />Controller层代码
```
@Api(tags = "教师信息管理控制器")
@RestController
@RequestMapping("/sms/teacherController")
public class TeacherController {

    @Autowired
    private TeacherService teacherService;
    
    @ApiOperation("获取教师信息,分页带条件")
    @GetMapping("/getTeachers/{pageNo}/{pageSize}")
    public Result getTeachers(
            @PathVariable("pageNo") Integer pageNo,
            @PathVariable("pageSize") Integer pageSize,
            Teacher teacher
    ){
        Page<Teacher> pageParam = new Page<>(pageNo,pageSize);
        IPage<Teacher> page = teacherService.getTeachersByOpr(pageParam, teacher);
        return Result.ok(page);
    }
}
```
service层代码
```
@Override
public IPage<Teacher> getTeachersByOpr(Page<Teacher> pageParam, Teacher teacher) {

    QueryWrapper queryWrapper = new QueryWrapper();
    if(teacher != null){
        //班级名称条件
        String clazzName = teacher.getClazzName();
        if (!StringUtils.isEmpty(clazzName)) {
            queryWrapper.eq("clazz_name",clazzName);
        }
        //教师名称条件
        String teacherName = teacher.getName();
        if(!StringUtils.isEmpty(teacherName)){
            queryWrapper.like("name",teacherName);
        }
        queryWrapper.orderByDesc("id");
        queryWrapper.orderByAsc("name");
    }

    IPage<Teacher> page = baseMapper.selectPage(pageParam, queryWrapper);

    return page;
}
```
该请求响应为<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695263200176-f9c5b3a4-d90f-4fb4-a03c-b9f3214c48ad.png#averageHue=%23fefcfc&clientId=ue76cf919-cd34-4&from=paste&height=229&id=u5d6ab794&originHeight=457&originWidth=1499&originalType=binary&ratio=2&rotation=0&showTitle=false&size=69648&status=done&style=none&taskId=u41a0cd6a-6bef-4a72-a57e-099487454ad&title=&width=749.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695263254648-c1d9cf5b-1dd9-4303-b4eb-7b0420e6be6e.png#averageHue=%23b3d0c9&clientId=ue76cf919-cd34-4&from=paste&height=632&id=u2ca7e9da&originHeight=1263&originWidth=1913&originalType=binary&ratio=2&rotation=0&showTitle=false&size=120450&status=done&style=none&taskId=uc1a46c22-58d2-49ea-ab52-9edfe9617fa&title=&width=956.5)
<a name="DgRAI"></a>
##### 添加和修改教师信息
填写表单数据<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265261220-4842a0eb-6399-4390-8141-22c6f6df7f1f.png#averageHue=%23fefefe&clientId=ue76cf919-cd34-4&from=paste&height=746&id=u7e247d62&originHeight=1657&originWidth=1187&originalType=binary&ratio=2&rotation=0&showTitle=false&size=93768&status=done&style=none&taskId=u7059716b-1021-4419-a2b0-650c68ce160&title=&width=534.5)<br />该操作请求数据响应头<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695263434496-958c97e2-c581-4c30-9370-580d3e808c74.png#averageHue=%23ada991&clientId=ue76cf919-cd34-4&from=paste&height=160&id=u40916177&originHeight=319&originWidth=1713&originalType=binary&ratio=2&rotation=0&showTitle=false&size=55820&status=done&style=none&taskId=ue9a007d4-3dd7-4529-aa22-f495e4d0fe4&title=&width=856.5)<br />Controller层代码
```
@ApiOperation("添加和修改教师信息")
@PostMapping("/saveOrUpdateTeacher")
public Result saveOrUpdateTeacher(
    @RequestBody Teacher teacher
){
    if (teacher.getId() != null) {
        // ID 不为空，执行修改操作
        teacherService.update(teacher);
    } else {
        // ID 为空，执行增加操作
        teacherService.add(teacher);
    }
    return Result.ok();
}
```
> 通过判断teacher对象的id属性是否为空来确定是执行增加操作还是修改操作。如果id不为空，则执行修改操作；如果id为空，则执行增加操作。

swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695263597139-6f4f00d1-a741-4fbf-892d-d0940b03e433.png#averageHue=%23e7f5ed&clientId=ue76cf919-cd34-4&from=paste&height=728&id=u16477bfc&originHeight=1455&originWidth=1915&originalType=binary&ratio=2&rotation=0&showTitle=false&size=178986&status=done&style=none&taskId=u5c284c6c-07ab-408e-82f3-0d1a3869199&title=&width=957.5)
<a name="wvOHv"></a>
##### 删除和批量删除教师信息
该删除操作请求路径<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695263626197-b06d2f25-3b22-4c16-8d7a-fc60700af4cc.png#averageHue=%23d8c9b5&clientId=ue76cf919-cd34-4&from=paste&height=160&id=ucc46e52e&originHeight=319&originWidth=1469&originalType=binary&ratio=2&rotation=0&showTitle=false&size=45789&status=done&style=none&taskId=ufecdf71d-2c79-4cbe-97ef-7fc40a1f56a&title=&width=734.5)<br />Controller层代码
```
@ApiOperation("删除一个或者多个教师信息")
@DeleteMapping("/deleteTeacher")
public Result deleteTeacher(
    @RequestBody List<Integer> ids
){
    if (ids.size() == 1) {
        // ids 列表只包含一个元素，执行删除操作
        teacherService.removeById(ids.get(0));
    } else {
        // ids 列表包含多个元素，执行批量删除操作
        teacherService.removeByIds(ids);
    }
    return Result.ok();
}
```
> 通过判断ids列表的大小来确定是执行删除操作还是批量删除操作。如果ids列表只包含一个元素，则执行删除操作；如果ids列表包含多个元素，则执行批量删除操作。

swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695263756087-2efa2b5c-761f-40fd-a44a-1d3bbec9d0cc.png#averageHue=%23f7efe3&clientId=ue76cf919-cd34-4&from=paste&height=492&id=u9fdd2f14&originHeight=983&originWidth=1897&originalType=binary&ratio=2&rotation=0&showTitle=false&size=90529&status=done&style=none&taskId=u95914d63-265c-4af4-819c-379f7ce9db7&title=&width=948.5)
<a name="YoKJw"></a>
#### 学生管理功能实现
<a name="TevzE"></a>
##### 搜索条件中班级选项
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695261968503-fcfe6620-d48d-4be6-897f-aa83b19a98bf.png#averageHue=%23fefdfd&clientId=ue76cf919-cd34-4&from=paste&height=309&id=zsjNw&originHeight=617&originWidth=1765&originalType=binary&ratio=2&rotation=0&showTitle=false&size=64788&status=done&style=none&taskId=udb432616-3651-4c1a-8215-bdc1bb4a677&title=&width=882.5)

Controller层代码
```
//查询所有班级信息
    @ApiOperation("查询所有班级的信息")
    @GetMapping("/getClazzs")
    public Result getClazzs(){
        List<Clazz> clazzes=clazzService.getClazzs();
        return Result.ok(clazzes);
    }
```
service层代码
```
@Service("clazzServiceImpl")
@Transactional //事务控制
public class ClazzServiceImpl extends ServiceImpl<ClazzMapper, Clazz> implements ClazzService {
    @Override
    public List<Clazz> getClazzs() {
        return baseMapper.selectList(null);
    }

}
```
swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695262855220-d7608278-ddd6-48ab-af71-f3cc738d6d4c.png#averageHue=%23b8ccbf&clientId=ue76cf919-cd34-4&from=paste&height=548&id=HLuut&originHeight=1095&originWidth=1913&originalType=binary&ratio=2&rotation=0&showTitle=false&size=100891&status=done&style=none&taskId=u3cd8dc1b-d8f1-4370-b1ff-b2b51c507f2&title=&width=956.5)

<a name="krTpd"></a>
##### 查询学生功能实现
先查询数据流的请求信息<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695264258243-3a9e5af2-82ce-4e3d-afae-e22525398e3c.png#averageHue=%23f2f4f6&clientId=ue76cf919-cd34-4&from=paste&height=163&id=u641cd09e&originHeight=325&originWidth=2829&originalType=binary&ratio=2&rotation=0&showTitle=false&size=58460&status=done&style=none&taskId=u96a7a0a9-f648-45cb-a5b2-06a04baa6bf&title=&width=1414.5)<br />Controller层代码
```

@Api(tags = "学生控制器")
@RestController
@RequestMapping("/sms/studentController")
public class StudentController {

    @Autowired
    private StudentService studentService;

    @ApiOperation("查询学生信息,分页带条件")
    @GetMapping("/getStudentByOpr/{pageNo}/{pageSize}")
    public Result getStudentsByOpr(
            @ApiParam("页码数") @PathVariable("pageNo")Integer pageNo,
            @ApiParam("页大小") @PathVariable("pageSize")Integer pageSize,
            @ApiParam("查询条件转换后端数据模型") Student student
            ){
        // 准备分页信息封装的page对象
        Page<Student> page =new Page<>(pageNo,pageSize);
        // 获取分页的学生信息
        IPage<Student> iPage = studentService.getStudentByOpr(page, student);
        // 返回学生信息
        return Result.ok(iPage);
    }
}
```
service层代码
```
@Service("stuService")
@Transactional
public class StudentServiceImpl extends ServiceImpl<StudentMapper, Student> implements StudentService {
    /**
     * 按条件查询学生信息【带分页】
     */
    public IPage<Student> getStudentByOpr(Page<Student> pageParam,Student student){
        QueryWrapper<Student> queryWrapper = null;
        if(student != null) {
            queryWrapper = new QueryWrapper<>();
            if (student.getClazzName() != null) {
                queryWrapper.eq("clazz_name", student.getClazzName());
            }
            if (student.getName() != null) {
                queryWrapper.like("name", student.getName());
            }
            queryWrapper.orderByDesc("id");
            queryWrapper.orderByAsc("name");
        }        
        //创建分页对象
        IPage<Student> pages = baseMapper.selectPage(pageParam, queryWrapper);

        return pages;
    }
```
请求响应<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265174669-3c8da9c2-f462-4e7b-8858-db5252b7d5f8.png#averageHue=%23fefcfc&clientId=ue76cf919-cd34-4&from=paste&height=223&id=ud766cdbd&originHeight=445&originWidth=1485&originalType=binary&ratio=2&rotation=0&showTitle=false&size=68538&status=done&style=none&taskId=ufccc4147-004d-47ad-9c70-97083310513&title=&width=742.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695264303437-ff1bcb23-ace5-429a-8d10-a1c544406dd9.png#averageHue=%23b3d0cc&clientId=ue76cf919-cd34-4&from=paste&height=811&id=u74dd1f75&originHeight=1621&originWidth=1925&originalType=binary&ratio=2&rotation=0&showTitle=false&size=160185&status=done&style=none&taskId=u37f1dcfa-59aa-4a60-b41a-fd911e2eed9&title=&width=962.5)
<a name="OQlUS"></a>
##### 添加和修改学生信息
填写表单数据<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265317130-28f2b6dc-3f4a-4f8f-b1d6-a50c03d44614.png#averageHue=%23fefefe&clientId=ue76cf919-cd34-4&from=paste&height=684&id=u8d242d37&originHeight=1635&originWidth=1223&originalType=binary&ratio=2&rotation=0&showTitle=false&size=99591&status=done&style=none&taskId=u06a89668-19f2-4c43-ace9-260dfccbb39&title=&width=511.5)<br />该操作数据请求<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265435997-f3354fd3-1926-4c25-ab4d-aa87d83330ec.png#averageHue=%23ada991&clientId=ue76cf919-cd34-4&from=paste&height=172&id=u2bf5392f&originHeight=343&originWidth=1845&originalType=binary&ratio=2&rotation=0&showTitle=false&size=55765&status=done&style=none&taskId=ub3311845-2766-4a89-80ad-9134975c6cd&title=&width=922.5)<br />Controller层代码
```
@Api(tags = "学生控制器")
@RestController
@RequestMapping("/sms/studentController")
public class StudentController {

    @Autowired
    private StudentService studentService;


    @ApiOperation("增加学生信息")
    @PostMapping("/addOrUpdateStudent")
    public Result addOrUpdateStudent(@RequestBody Student student){
        //对学生的密码进行加密
        if (!Strings.isEmpty(student.getPassword())) {
            student.setPassword(MD5.encrypt(student.getPassword()));
        }
        //保存学生信息进入数据库
        studentService.saveOrUpdate(student);
        return Result.ok();
    }
}
```
> 根据学生对象是否具有唯一标识（如学生ID）来进行判断。如果学生对象具有唯一标识，则可以将其视为修改操作；否则，可以将其视为增加操作。

该操作响应<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265471764-995453b7-9d3e-48b5-b69e-dba5bf93d5c8.png#averageHue=%23dcba8e&clientId=ue76cf919-cd34-4&from=paste&height=142&id=uc47b3992&originHeight=283&originWidth=1337&originalType=binary&ratio=2&rotation=0&showTitle=false&size=34671&status=done&style=none&taskId=u405b7bfa-e232-4372-b4c9-0ee906c3dbe&title=&width=668.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265759680-ca2ddd78-0523-4ebc-a76f-f339c7ad862e.png#averageHue=%23f0f9e8&clientId=ue76cf919-cd34-4&from=paste&height=650&id=u5b9a93db&originHeight=1299&originWidth=1941&originalType=binary&ratio=2&rotation=0&showTitle=false&size=132653&status=done&style=none&taskId=ub9735d0b-9d81-4689-a7e4-6d8f449296a&title=&width=970.5)
<a name="Mcv4Y"></a>
##### 删除和批量删除学生信息
该操作请求路径<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265859341-fd7a7dec-9909-4f06-b00f-b04c6a7aa4e8.png#averageHue=%23f2f3f3&clientId=ue76cf919-cd34-4&from=paste&height=163&id=u3e6e9203&originHeight=325&originWidth=1539&originalType=binary&ratio=2&rotation=0&showTitle=false&size=47769&status=done&style=none&taskId=u092e2371-a0d3-4532-986a-ed2589299cd&title=&width=769.5)<br />Controller层代码
```
@Api(tags = "学生控制器")
@RestController
@RequestMapping("/sms/studentController")
public class StudentController {

    @Autowired
    private StudentService studentService;


    @ApiOperation("删除一个或者多个学生信息")
    @DeleteMapping("/delStudentById")
    public Result delStudentById(
            @ApiParam("多个学生id的JSON") @RequestBody List<Integer> ids
    ){
        studentService.removeByIds(ids);
        return Result.ok();
    }
}
```
该请求响应数据<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265921019-1249c96b-a157-4c9d-96e6-02642c60569f.png#averageHue=%23e0bd8f&clientId=ue76cf919-cd34-4&from=paste&height=114&id=ufabaff3b&originHeight=227&originWidth=1449&originalType=binary&ratio=2&rotation=0&showTitle=false&size=28630&status=done&style=none&taskId=u7bf3b843-1318-4885-bad3-3816878ca4a&title=&width=724.5)<br />swagger测试接口<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1695265987575-81b9efd5-53ff-4cfe-b96e-192dfc3fed56.png#averageHue=%23f7eee6&clientId=ue76cf919-cd34-4&from=paste&height=710&id=u76bbad09&originHeight=1419&originWidth=1921&originalType=binary&ratio=2&rotation=0&showTitle=false&size=128769&status=done&style=none&taskId=u89fc04b6-9900-4c64-bd73-7fa21037b11&title=&width=960.5)
<a name="S2DKk"></a>
#### 项目bug解决
**项目启动报错“javax.xml.bind.DatatypeConverter”**<br />项目启动时没有问题，swagger调接口也没有问题，前后端联调的时候出现以下问题，提示：javax.xml.bind.DatatypeConverter<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35027732/1690552947739-d055d0a9-388a-4bb0-a9bc-7f22003ea231.png#averageHue=%23f5f4f2&clientId=u242ab4e3-5158-4&from=paste&height=145&id=u74e15449&originHeight=290&originWidth=2041&originalType=binary&ratio=2&rotation=0&showTitle=false&size=100084&status=done&style=none&taskId=uf392ad3d-f6e8-429c-b958-787e416a881&title=&width=1020.5)<br />JAXB API是java EE 的API，因此在java SE 9.0 中不再包含这个 Jar 包。<br />java 9 中引入了模块的概念，默认情况下，Java SE中将不再包含java EE 的Jar包而在 <br />java 6/7 / 8 时关于这个API 都是捆绑在一起的<br />jar包中缺少这一依赖-javax.xml.bind.api<br />导入依赖即可。
```
<dependency>
	<groupId>javax.xml.bind</groupId>
	<artifactId>jaxb-api</artifactId>
	<version>2.3.0</version>
</dependency>
```

<a name="of3OI"></a>
## 项目总结
智慧校园云端管理系统是一个基于前后端分离架构的校园管理系统，主要用于管理校内学生、老师、班级和年级的相关信息，并提供学生和老师信息记录和统计的功能。该系统采用了以下技术和工具：

- 前端技术：HTML、CSS和Vue.js，用于实现页面效果展示和交互功能。
- 后端框架：Spring Boot和MyBatis Plus，用于实现数据存储和服务。
- 数据库：MySQL，作为存储层，提供高性能的数据存储和查询。
- 服务器：使用Spring Boot内置的Tomcat 9.x作为Web服务器，用于部署和运行系统。
- 项目构建工具：Maven，用于管理项目依赖和构建过程。

系统的用户角色包括管理员、老师和学生。每个角色都有不同的功能和权限：

- 管理员角色：可以进行学生、老师、年级和班级信息的管理，包括添加、编辑和删除操作，还可以管理个人信息和重置账户密码。
- 老师角色：可以参与相关学生和班级信息的管理，包括查看和编辑操作，同时也可以管理个人信息。
- 学生角色：可以查看自己所在班级的信息、同学信息，还可以管理个人信息。

通过该系统，管理员可以方便地管理校园的核心基础业务数据，老师和学生可以更好地进行信息管理和查看。采用前后端分离架构使得系统具有良好的可维护性和扩展性。<br />在项目开发过程中，我们遵循了MVC设计模式，合理划分了前后端的职责，提高了开发效率和代码质量。同时，我们也注重系统的安全性和性能优化，确保系统的稳定运行和良好的用户体验。<br />总体而言，智慧校园云端管理系统为校园信息化建设提供了一个强大而高效的工具，帮助管理者更好地管理学生、老师、班级和年级的相关信息。在未来的发展中，可以进一步扩展系统的功能和优化用户体验，以满足不断变化的需求。
